"use strict";(self.webpackChunkswarmcloud_docs=self.webpackChunkswarmcloud_docs||[]).push([[1987],{5680:(e,t,n)=>{n.d(t,{xA:()=>u,yg:()=>m});var r=n(6540);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function p(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),s=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=s(e.components);return r.createElement(l.Provider,{value:t},e.children)},c="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef(function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,u=p(e,["components","mdxType","originalType","parentName"]),c=s(n),d=a,m=c["".concat(l,".").concat(d)]||c[d]||g[d]||o;return n?r.createElement(m,i(i({ref:t},u),{},{components:n})):r.createElement(m,i({ref:t},u))});function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var p={};for(var l in t)hasOwnProperty.call(t,l)&&(p[l]=t[l]);p.originalType=e,p[c]="string"==typeof e?e:a,i[1]=p;for(var s=2;s<o;s++)i[s]=n[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7537:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>m,frontMatter:()=>p,metadata:()=>s,toc:()=>c});n(6540);var r=n(5680);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const p={title:"API & Config",sidebar_position:3},l=void 0,s={unversionedId:"API",id:"API",title:"API & Config",description:"P2P Configuration",source:"@site/docs/flutter/API.mdx",sourceDirName:".",slug:"/API",permalink:"/home/flutter/API",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"API & Config",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Usage",permalink:"/home/flutter/"}},u={},c=[{value:"P2P Configuration",id:"p2p-configuration",level:2},{value:"P2pEngine",id:"p2pengine",level:2},{value:"Switch Stream URL",id:"switch-stream-url",level:3},{value:"FlutterP2pEngine API",id:"flutterp2pengine-api",level:3},{value:"P2P Statistics",id:"p2p-statistics",level:3},{value:"Callback Player Stats",id:"callback-player-stats",level:3},{value:"Dynamic m3u8 Path Support",id:"dynamic-m3u8-path-support",level:3},{value:"Setup HTTP headers",id:"setup-http-headers",level:3}],g={toc:c},d="wrapper";function m(e){var{components:t}=e,n=i(e,["components"]);return(0,r.yg)(d,o(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}({},g,n),{components:t,mdxType:"MDXLayout"}),(0,r.yg)("h2",{id:"p2p-configuration"},"P2P Configuration"),(0,r.yg)("p",null,"See ",(0,r.yg)("a",{parentName:"p",href:"/android/API"},"Android"),", ",(0,r.yg)("a",{parentName:"p",href:"/ios/API"},"iOS")," Configuration and ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/cdnbye/flutter-p2p-engine/blob/a1b413ae781d4e3edd1a1e163c2b4f5993da6dca/lib/flutter_p2p_engine.dart#L76"},"Type Definition")),(0,r.yg)("h2",{id:"p2pengine"},"P2pEngine"),(0,r.yg)("p",null,"Instantiate P2pEngine, which is a singleton:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-dart"},"FlutterP2pEngine.init(\n  token, /// replace with your token\n  config: P2pConfig.byDefault()\n);\n")),(0,r.yg)("p",null,"Explanation:"),(0,r.yg)("br",null),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"center"},"param"),(0,r.yg)("th",{parentName:"tr",align:"center"},"type"),(0,r.yg)("th",{parentName:"tr",align:"center"},"required"),(0,r.yg)("th",{parentName:"tr",align:"center"},"description"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"token"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"String"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Yes"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Token assigned by SwarmCloud")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"config"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"P2pConfig"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Yes"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Custom configuration")))),(0,r.yg)("h3",{id:"switch-stream-url"},"Switch Stream URL"),(0,r.yg)("p",null,"When switching to a new stream URL, before passing new stream url(m3u8) to the player, pass that URL through ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("em",{parentName:"strong"},"parseStreamURL"))," :"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-dart"},"String parsedUrl = await FlutterP2pEngine.parseStreamURL(url);\n")),(0,r.yg)("h3",{id:"flutterp2pengine-api"},"FlutterP2pEngine API"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-dart"},"/// The version of SDK.\nstatic Future<String> getSDKVersion()\n\n/// Create a new instance with token and the specified config.\nstatic Future<int> init(\n  token, {\n  P2pConfig config,\n  void Function(Map<String, dynamic>)? infoListener\n})\n\n/// Get parsed local stream url by passing the original stream url(m3u8) .\nstatic Future<String> parseStreamURL(\n  String sourceUrl, [\n  String videoId,\n])\n\n/// Set HTTP Headers while requesting ts and m3u8 dynamically.\nstatic Future setHttpHeadersForHls(Map<String, String>? headers)\n\n/// Set HTTP Headers while requesting Dash files dynamically.\nstatic Future setHttpHeadersForDash(Map<String, String>? headers)\n\n/// Get the connection state of p2p engine.\nstatic Future<bool> isConnected()\n\n/// Restart p2p engine.\nstatic Future restartP2p()\n\n/// Stop p2p and free used resources.\nstatic Future stopP2p()\n\n/// Get the peer ID of p2p engine.\nstatic Future<String> getPeerId()\n")),(0,r.yg)("h3",{id:"p2p-statistics"},"P2P Statistics"),(0,r.yg)("p",null,"Please see ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/cdnbye/flutter-p2p-engine/blob/main/example/lib/main.dart"},"example")),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"The unit of download and upload is KB.")),(0,r.yg)("h3",{id:"callback-player-stats"},"Callback Player Stats"),(0,r.yg)("p",null,"On HLS Live streaming, to improve performance, we recommend to tell p2p engine the duration from the playback time to the end of the buffered interval. In order to do so, you need to use callback ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("em",{parentName:"strong"},"bufferedDurationGenerator"))," ."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-dart"},"FlutterP2pEngine.init(\n  token, /// replace with your token\n  bufferedDurationGeneratorEnable: true,\n);\nString parsedUrl = await FlutterP2pEngine.parseStreamURL(\n  url,\n  bufferedDurationGenerator: () {\n    return vpController!.value.buffered.last.end - vpController!.value.position;\n  },\n);\n")),(0,r.yg)("h3",{id:"dynamic-m3u8-path-support"},"Dynamic m3u8 Path Support"),(0,r.yg)("p",null,"The channelId is an identifier used by our backend to match peers that are watching the same content. It is an optional parameter, and by default, we generate channelId from the content URL by removing any query parameters and protocol from it. Some m3u8 urls play the same live/vod but have different paths on them. For example, example.com/clientId1/streamId.m3u8 and example.com/clientId2/streamId.m3u8. In this case, you can format a common channelId for them."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-dart"},"String videoId = extractVideoIdFromUrl(originalUrl);     /// extractVideoIdFromUrl is a function defined by yourself, you just need to extract video id from url\nString url = await FlutterP2pEngine.parseStreamURL(originalUrl, videoId);\n")),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"Interconnect with other platform should ensure that both have the same token and channelId.")),(0,r.yg)("h3",{id:"setup-http-headers"},"Setup HTTP headers"),(0,r.yg)("p",null,"Some HTTP requests need to add header information such as ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("em",{parentName:"strong"},"referer"))," or ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("em",{parentName:"strong"},"User-Agent"))," for Anti-Leech or statistical requirements. It can be set via ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("em",{parentName:"strong"},"httpHeadersForHls"))," :"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-dart"},'FlutterP2pEngine.setHttpHeadersForHls({\n    "referer": "XXX",\n    "User-Agent": "XXX",\n});\n')))}m.isMDXComponent=!0}}]);