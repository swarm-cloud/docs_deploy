"use strict";(self.webpackChunkswarmcloud_docs=self.webpackChunkswarmcloud_docs||[]).push([[642],{371:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>g,default:()=>f,frontMatter:()=>s,metadata:()=>p,toc:()=>d});t(6540);var a=t(5680);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,a)}return t}(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}),e}function i(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}const s={title:"API & Config",sidebar_position:3},g=void 0,p={unversionedId:"API",id:"API",title:"API & Config",description:"Create instance",source:"@site/docs/shaka/API.mdx",sourceDirName:".",slug:"/API",permalink:"/home/shaka/API",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"API & Config",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Usage",permalink:"/home/shaka/"}},l={},d=[{value:"Create instance",id:"create-instance",level:2},{value:"var engine = new P2PEngineShaka(player, {p2pConfig: opts}, shaka = window.shaka);",id:"var-engine--new-p2pengineshakaplayer-p2pconfig-opts-shaka--windowshaka",level:3},{value:"P2PEngineShaka API",id:"p2pengineshaka-api",level:2},{value:"<strong><em>P2PEngineShaka.version</em></strong> (static method)",id:"p2pengineshakaversion-static-method",level:4},{value:"<strong><em>P2PEngineShaka.protocolVersion</em></strong> (static method)",id:"p2pengineshakaprotocolversion-static-method",level:4},{value:"<strong><em>P2PEngineShaka.isSupported()</em></strong> (static method)",id:"p2pengineshakaissupported-static-method",level:4},{value:"<strong><em>engine.enableP2P()</em></strong>",id:"engineenablep2p",level:4},{value:"<strong><em>engine.disableP2P()</em></strong>",id:"enginedisablep2p",level:4},{value:"<strong><em>engine.destroy()</em></strong>",id:"enginedestroy",level:4},{value:"P2PEngineShaka Events",id:"p2pengineshaka-events",level:2},{value:"<strong><em>engine.on(&#39;peerId&#39;, function (peerId) {})</em></strong>",id:"engineonpeerid-function-peerid-",level:4},{value:"<strong><em>engine.on(&#39;peers&#39;, function (peers) {})</em></strong>",id:"engineonpeers-function-peers-",level:4},{value:"<strong><em>engine.on(&#39;stats&#39;, function (stats) {})</em></strong>",id:"engineonstats-function-stats-",level:4},{value:"<strong><em>engine.on(&#39;serverConnected&#39;, function (connected) {})</em></strong>",id:"engineonserverconnected-function-connected-",level:3},{value:"<strong><em>engine.on(&#39;exception&#39;, function (e) {})</em></strong>",id:"engineonexception-function-e-",level:3},{value:"Get p2p information from p2pConfig",id:"get-p2p-information-from-p2pconfig",level:3},{value:"Advanced Usage",id:"advanced-usage",level:2},{value:"Dynamic M3u8/mpd Path Support",id:"dynamic-m3u8mpd-path-support",level:3},{value:"Dynamic Segment Path Support",id:"dynamic-segment-path-support",level:3},{value:"Use Your Own STUN or TURN Server",id:"use-your-own-stun-or-turn-server",level:3},{value:"Allow Http Range Request",id:"allow-http-range-request",level:3},{value:"How to Check Segment Validity",id:"how-to-check-segment-validity",level:3}],c=e=>function(n){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,a.yg)("div",n)},m=c("Tabs"),y=c("TabItem"),u={toc:d},h="wrapper";function f(e){var{components:n}=e,t=i(e,["components"]);return(0,a.yg)(h,o(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},a=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.forEach(function(n){r(e,n,t[n])})}return e}({},u,t),{components:n,mdxType:"MDXLayout"}),(0,a.yg)("h2",{id:"create-instance"},"Create instance"),(0,a.yg)("h3",{id:"var-engine--new-p2pengineshakaplayer-p2pconfig-opts-shaka--windowshaka"},"var engine = new P2PEngineShaka(player, {p2pConfig: ","[opts]","}, shaka = window.shaka);"),(0,a.yg)("p",null,"Create a new ",(0,a.yg)("strong",{parentName:"p"},(0,a.yg)("em",{parentName:"strong"},"P2PEngineShaka"))," instance, ",(0,a.yg)("strong",{parentName:"p"},(0,a.yg)("em",{parentName:"strong"},"player"))," is an instance of ",(0,a.yg)("strong",{parentName:"p"},(0,a.yg)("em",{parentName:"strong"},"Shaka Player"))," ."),(0,a.yg)("p",null,"If ",(0,a.yg)("strong",{parentName:"p"},(0,a.yg)("em",{parentName:"strong"},"opts"))," is specified, then the default options (shown below) will be overridden."),(0,a.yg)("table",null,(0,a.yg)("thead",{parentName:"table"},(0,a.yg)("tr",{parentName:"thead"},(0,a.yg)("th",{parentName:"tr",align:"center"},"Field"),(0,a.yg)("th",{parentName:"tr",align:"center"},"Type"),(0,a.yg)("th",{parentName:"tr",align:"center"},"Default"),(0,a.yg)("th",{parentName:"tr",align:"center"},"Description"))),(0,a.yg)("tbody",{parentName:"table"},(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:"center"},"logLevel"),(0,a.yg)("td",{parentName:"tr",align:"center"},"string","|","boolean"),(0,a.yg)("td",{parentName:"tr",align:"center"},"'error'"),(0,a.yg)("td",{parentName:"tr",align:"center"},"Print log level(warn, error, none, false=none, true=warn).")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:"center"},"token"),(0,a.yg)("td",{parentName:"tr",align:"center"},"string"),(0,a.yg)("td",{parentName:"tr",align:"center"},"undefined"),(0,a.yg)("td",{parentName:"tr",align:"center"},"Token is used to summarize and display multi domain name data on the console. In addition, token is required while customizing channelId.")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:"center"},"trackerZone"),(0,a.yg)("td",{parentName:"tr",align:"center"},"string"),(0,a.yg)("td",{parentName:"tr",align:"center"},"'eu'"),(0,a.yg)("td",{parentName:"tr",align:"center"},"The country code name of the tracker server address('eu', 'hk', 'us').")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:"center"},"memoryCacheLimit"),(0,a.yg)("td",{parentName:"tr",align:"center"},"Object"),(0,a.yg)("td",{parentName:"tr",align:"center"},'{"pc": 400 ',"*"," 1024 ","*",' 1024, "mobile": 100 ',"*"," 1024 ","*"," 1024}"),(0,a.yg)("td",{parentName:"tr",align:"center"},"The max size of binary data that can be stored in the cache.")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:"center"},"useDiskCache"),(0,a.yg)("td",{parentName:"tr",align:"center"},"boolean"),(0,a.yg)("td",{parentName:"tr",align:"center"},"true"),(0,a.yg)("td",{parentName:"tr",align:"center"},"Use IndexedDB to cache data for VOD streaming.")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:"center"},"diskCacheLimit"),(0,a.yg)("td",{parentName:"tr",align:"center"},"Object"),(0,a.yg)("td",{parentName:"tr",align:"center"},'{"pc": 1500 ',"*"," 1024 ","*",' 1024, "mobile": 1000 ',"*"," 1024 ","*"," 1024}"),(0,a.yg)("td",{parentName:"tr",align:"center"},"The max size of binary data that can be stored in the disk cache.")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:"center"},"p2pEnabled"),(0,a.yg)("td",{parentName:"tr",align:"center"},"boolean"),(0,a.yg)("td",{parentName:"tr",align:"center"},"true"),(0,a.yg)("td",{parentName:"tr",align:"center"},"Enable or disable p2p engine.")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:"center"},"webRTCConfig"),(0,a.yg)("td",{parentName:"tr",align:"center"},"Object"),(0,a.yg)("td",{parentName:"tr",align:"center"},"{}"),(0,a.yg)("td",{parentName:"tr",align:"center"},"A ",(0,a.yg)("a",{parentName:"td",href:"https://github.com/feross/simple-peer"},"Configuration dictionary")," providing options to configure WebRTC connections.")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:"center"},"useHttpRange"),(0,a.yg)("td",{parentName:"tr",align:"center"},"boolean"),(0,a.yg)("td",{parentName:"tr",align:"center"},"true"),(0,a.yg)("td",{parentName:"tr",align:"center"},"Use HTTP ranges requests where it is possible. Allows to continue (and not start over) aborted P2P downloads over HTTP.")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:"center"},"sharePlaylist"),(0,a.yg)("td",{parentName:"tr",align:"center"},"boolean"),(0,a.yg)("td",{parentName:"tr",align:"center"},"false"),(0,a.yg)("td",{parentName:"tr",align:"center"},"Allow the P2P transmission of m3u8 file.")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:"center"},"prefetchOnly"),(0,a.yg)("td",{parentName:"tr",align:"center"},"boolean"),(0,a.yg)("td",{parentName:"tr",align:"center"},"false"),(0,a.yg)("td",{parentName:"tr",align:"center"},"Only use prefetch strategy in p2p downloading(Only for HLS).")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:"center"},"startFromSegmentOffset"),(0,a.yg)("td",{parentName:"tr",align:"center"},"number"),(0,a.yg)("td",{parentName:"tr",align:"center"},"3"),(0,a.yg)("td",{parentName:"tr",align:"center"},"The segment offset that start to connect to tracker server.")))),(0,a.yg)("h2",{id:"p2pengineshaka-api"},"P2PEngineShaka API"),(0,a.yg)("h4",{id:"p2pengineshakaversion-static-method"},(0,a.yg)("strong",{parentName:"h4"},(0,a.yg)("em",{parentName:"strong"},"P2PEngineShaka.version"))," (static method)"),(0,a.yg)("p",null,"Get the version of P2PEngineShaka."),(0,a.yg)("h4",{id:"p2pengineshakaprotocolversion-static-method"},(0,a.yg)("strong",{parentName:"h4"},(0,a.yg)("em",{parentName:"strong"},"P2PEngineShaka.protocolVersion"))," (static method)"),(0,a.yg)("p",null,"Get the version of P2P protocol."),(0,a.yg)("h4",{id:"p2pengineshakaissupported-static-method"},(0,a.yg)("strong",{parentName:"h4"},(0,a.yg)("em",{parentName:"strong"},"P2PEngineShaka.isSupported()"))," (static method)"),(0,a.yg)("p",null,"Returns true if WebRTC data channel is supported by the browser."),(0,a.yg)("h4",{id:"engineenablep2p"},(0,a.yg)("strong",{parentName:"h4"},(0,a.yg)("em",{parentName:"strong"},"engine.enableP2P()"))),(0,a.yg)("p",null,"Resume P2P if it has been stopped."),(0,a.yg)("h4",{id:"enginedisablep2p"},(0,a.yg)("strong",{parentName:"h4"},(0,a.yg)("em",{parentName:"strong"},"engine.disableP2P()"))),(0,a.yg)("p",null,"Disable engine to stop p2p and free used resources."),(0,a.yg)("h4",{id:"enginedestroy"},(0,a.yg)("strong",{parentName:"h4"},(0,a.yg)("em",{parentName:"strong"},"engine.destroy()"))),(0,a.yg)("p",null,"Stop p2p and free used resources."),(0,a.yg)("h2",{id:"p2pengineshaka-events"},"P2PEngineShaka Events"),(0,a.yg)("h4",{id:"engineonpeerid-function-peerid-"},(0,a.yg)("strong",{parentName:"h4"},(0,a.yg)("em",{parentName:"strong"},"engine.on('peerId', function (peerId) {})"))),(0,a.yg)("p",null,"Emitted when the peer Id of this client is obtained from server."),(0,a.yg)("h4",{id:"engineonpeers-function-peers-"},(0,a.yg)("strong",{parentName:"h4"},(0,a.yg)("em",{parentName:"strong"},"engine.on('peers', function (peers) {})"))),(0,a.yg)("p",null,"Emitted when successfully connected with new peer."),(0,a.yg)("h4",{id:"engineonstats-function-stats-"},(0,a.yg)("strong",{parentName:"h4"},(0,a.yg)("em",{parentName:"strong"},"engine.on('stats', function (stats) {})"))),(0,a.yg)("p",null,"Emitted when data is downloaded/uploaded.",(0,a.yg)("br",null),"\nstats.totalHTTPDownloaded: total data downloaded by HTTP(KB).",(0,a.yg)("br",null),"\nstats.totalP2PDownloaded: total data downloaded by P2P(KB).",(0,a.yg)("br",null),"\nstats.totalP2PUploaded: total data uploaded by P2P(KB).",(0,a.yg)("br",null),"\nstats.p2pDownloadSpeed: p2p download speed(KB/s)."),(0,a.yg)("h3",{id:"engineonserverconnected-function-connected-"},(0,a.yg)("strong",{parentName:"h3"},(0,a.yg)("em",{parentName:"strong"},"engine.on('serverConnected', function (connected) {})"))),(0,a.yg)("p",null,"Emitted when websocket is opened/closed."),(0,a.yg)("h3",{id:"engineonexception-function-e-"},(0,a.yg)("strong",{parentName:"h3"},(0,a.yg)("em",{parentName:"strong"},"engine.on('exception', function (e) {})"))),(0,a.yg)("p",null,"Emitted when exception occured.",(0,a.yg)("br",null),"\ne.code: Exception identifier\uff08TRACKER_EXPT SIGNAL_EXPT\uff09",(0,a.yg)("br",null),"\ne.message: Exception message ",(0,a.yg)("br",null),"\ne.stack: Exception stack ",(0,a.yg)("br",null)),(0,a.yg)("h3",{id:"get-p2p-information-from-p2pconfig"},"Get p2p information from p2pConfig"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-javascript"},"p2pConfig: {\n    getStats: function (totalP2PDownloaded, totalP2PUploaded, totalHTTPDownloaded, p2pDownloadSpeed) {\n        // get the downloading statistics\n    },\n    getPeerId: function (peerId) {\n        // get peer Id\n    },\n    getPeersInfo: function (peers) {\n        // get peers information\n    },\n    onHttpDownloaded: function (traffic) {\n        // listen to http downloaded traffic\n    },\n    onP2pDownloaded: function (traffic, speed) {\n        // listen to p2p downloaded traffic\n    },\n    onP2pUploaded: function (traffic) {\n        // listen to p2p uploaded traffic\n    },\n}\n")),(0,a.yg)("admonition",{type:"note"},(0,a.yg)("p",{parentName:"admonition"},"The unit of download and upload is KB.\nThe unit of download speed is KB/s.")),(0,a.yg)("h2",{id:"advanced-usage"},"Advanced Usage"),(0,a.yg)("h3",{id:"dynamic-m3u8mpd-path-support"},"Dynamic M3u8/mpd Path Support"),(0,a.yg)("p",null,"Some m3u8/mpd urls play the same live/vod but have different paths on them. For example,\nexample.com/clientId1/streamId.mpd and example.com/clientId2/streamId.mpd. In this case, you can format a common channelId for them."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-javascript"},"// Set token in p2pConfig before setting channelId!\np2pConfig: {\n    token: YOUR_TOKEN,\n    channelId: function (mpdUrl) {\n        const videoId = extractVideoIdFromUrl(mpdUrl);   // make a channelId by removing the different part which is defined by yourself\n        return videoId;\n    }\n    // channelId: VIDEO_ID       // for fixed channel id\n}\n")),(0,a.yg)("h3",{id:"dynamic-segment-path-support"},"Dynamic Segment Path Support"),(0,a.yg)("p",null,"Like dynamic mpd path, you should format a common segmentId for the same segment file. You can override the segment ID like this:"),(0,a.yg)(m,{mdxType:"Tabs"},(0,a.yg)(y,{value:"mpd",label:".mpd",mdxType:"TabItem"},(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-javascript"},"p2pConfig: {\n    /*\n        segmentUrl: The url of segment\n        range: The byte range of segment\n     */\n    segmentId: function (segmentUrl, range) {\n        const segId = extractSegmentIdFromUrl(segmentUrl, range);\n        return segId;\n    }\n}\n"))),(0,a.yg)(y,{value:"m3u8",label:".m3u8",mdxType:"TabItem"},(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-javascript"},"p2pConfig: {\n    /*\n        streamId: The id of stream\n        sn: The serial number of segment\n        segmentUrl: The url of segment\n        range: The byte range of segment\n     */\n    segmentId: function (streamId, sn, segmentUrl, range) {\n        const tsId = extractSegmentIdFromUrl(segmentUrl);\n        return tsId;\n    }\n}\n")))),(0,a.yg)("h3",{id:"use-your-own-stun-or-turn-server"},"Use Your Own STUN or TURN Server"),(0,a.yg)("p",null,"STUN (Session Traversal Utilities for NAT) allows clients to discover their public IP address and the type of NAT they are behind. This information is used to establish the media connection. Although there are default STUN servers in this SDK, you can replace them with your own via P2PConfig. TURN (Traversal Using Relays around NAT) server is used to relay traffic if direct connection fails. You can config your ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/coturn/coturn"},"TURN")," server in the same way as STUN."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-javascript"},"p2pConfig: {\n    webRTCConfig: {\n       iceServers: [\n           { urls: YOUR_STUN_OR_TURN_SERVER }\n       ]\n    }\n}\n")),(0,a.yg)("h3",{id:"allow-http-range-request"},"Allow Http Range Request"),(0,a.yg)("p",null,"If http range request is activated, we are able to get chunks of data from peer and then complete the segments by getting other chunks from the CDN, thus, reducing your CDN bandwidth. Besides, the code below is needed\uff1a"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-javascript"},"p2pConfig: {\n    useHttpRange: true,\n}\n")),(0,a.yg)("h3",{id:"how-to-check-segment-validity"},"How to Check Segment Validity"),(0,a.yg)("p",null,"Sometimes we need to prevent a peer from sending a fake segment\n(such as the bittorrent with a hash function).\nCDNBye provides a validation callback with buffer of the\ndownloaded segment, developer should implement the actual\nvalidator. For example, you can create a program that generates\nhashes for the segments and stores them in a specific file or\ninjects into m3u8 playlist files the hashes information. If\nthe callback returns false, then the segment is not valid."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-javascript"},"p2pConfig: {\n   validateSegment: function (segId, buffer) {\n       var hash = hashFile.getHash(segId);\n       return hash === md5(buffer);\n   }\n}\n")))}f.isMDXComponent=!0},5680:(e,n,t)=>{t.d(n,{xA:()=>l,yg:()=>y});var a=t(6540);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach(function(n){r(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var g=a.createContext({}),p=function(e){var n=a.useContext(g),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},l=function(e){var n=p(e.components);return a.createElement(g.Provider,{value:n},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef(function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,g=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),d=p(t),m=r,y=d["".concat(g,".").concat(m)]||d[m]||c[m]||o;return t?a.createElement(y,i(i({ref:n},l),{},{components:t})):a.createElement(y,i({ref:n},l))});function y(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=m;var s={};for(var g in n)hasOwnProperty.call(n,g)&&(s[g]=n[g]);s.originalType=e,s[d]="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=t[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"}}]);