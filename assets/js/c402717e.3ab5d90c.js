"use strict";(self.webpackChunkswarmcloud_docs=self.webpackChunkswarmcloud_docs||[]).push([[4528],{5908:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>u,contentTitle:()=>d,default:()=>f,frontMatter:()=>s,metadata:()=>g,toc:()=>c});a(6540);var o=a(5680),r=a(4235),t=a(8328);function i(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function l(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),a.push.apply(a,o)}return a}(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}),e}function p(e,n){if(null==e)return{};var a,o,r=function(e,n){if(null==e)return{};var a,o,r={},t=Object.keys(e);for(o=0;o<t.length;o++)a=t[o],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(o=0;o<t.length;o++)a=t[o],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}const s={title:"Usage",sidebar_position:2,slug:"/"},d=void 0,g={unversionedId:"usage",id:"usage",title:"Usage",description:"Environment Configuration",source:"@site/docs/android/usage.mdx",sourceDirName:".",slug:"/",permalink:"/home/android/",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Usage",sidebar_position:2,slug:"/"},sidebar:"tutorialSidebar",previous:{title:"Introduction",permalink:"/home/android/introduction"},next:{title:"API & Config",permalink:"/home/android/API"}},u={},c=[{value:"Environment Configuration",id:"environment-configuration",level:2},{value:"Developing Environment",id:"developing-environment",level:3},{value:"Turn on Java 8 support",id:"turn-on-java-8-support",level:3},{value:"Add Uses Permission",id:"add-uses-permission",level:3},{value:"Allow Localhost Connections",id:"allow-localhost-connections",level:3},{value:"Enable LargeHeap",id:"enable-largeheap",level:3},{value:"Proguard Configuration",id:"proguard-configuration",level:3},{value:"Import SDK",id:"import-sdk",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Import P2pEngine",id:"import-p2pengine",level:3},{value:"Initialize P2pEngine",id:"initialize-p2pengine",level:3},{value:"Playback Address",id:"playback-address",level:3},{value:"Setup Player Interactor For Exoplayer",id:"setup-player-interactor-for-exoplayer",level:3},{value:"Demo",id:"demo",level:4},{value:"Troubleshooting Steps when P2P doesn&#39;t work",id:"troubleshooting-steps-when-p2p-doesnt-work",level:4}],m={toc:c},y="wrapper";function f(e){var{components:n}=e,a=p(e,["components"]);return(0,o.yg)(y,l(function(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{},o=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),o.forEach(function(n){i(e,n,a[n])})}return e}({},m,a),{components:n,mdxType:"MDXLayout"}),(0,o.yg)("h2",{id:"environment-configuration"},"Environment Configuration"),(0,o.yg)("h3",{id:"developing-environment"},"Developing Environment"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Android Studio, ",(0,o.yg)("a",{parentName:"li",href:"http://developer.android.com/intl/zh-cn/sdk/index.html"},"download"))),(0,o.yg)("h3",{id:"turn-on-java-8-support"},"Turn on Java 8 support"),(0,o.yg)("p",null,"If not enabled already, you also need to turn on Java 8 support in application's build.gradle, by adding the following to the android section:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},"android {\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    }\n}\n")),(0,o.yg)("h3",{id:"add-uses-permission"},"Add Uses Permission"),(0,o.yg)("p",null,"Add relevant uses permissions in ",(0,o.yg)("strong",{parentName:"p"},(0,o.yg)("em",{parentName:"strong"},"app/src/main/AndroidManifest.xml")),":"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-xml"},'<uses-permission android:name="android.permission.INTERNET" />\n<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />\n<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />\n<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />\n<uses-permission android:name="android.permission.ACCESS_WIFI_STATE" />\n')),(0,o.yg)("h3",{id:"allow-localhost-connections"},"Allow Localhost Connections"),(0,o.yg)("p",null,"Update the AndroidManifest.xml file:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-xml"},'<application\n  ...\n  android:networkSecurityConfig="@xml/network_security_config"\n  ...\n    />\n')),(0,o.yg)("p",null,"Then create or update the res/xml/network_security_config.xml file to allow localhost connections:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-xml"},'<?xml version="1.0" encoding="utf-8"?>\n<network-security-config>\n    <domain-config cleartextTrafficPermitted="true">\n        <domain includeSubdomains="true">127.0.0.1</domain>\n    </domain-config>\n</network-security-config>\n')),(0,o.yg)("h3",{id:"enable-largeheap"},"Enable LargeHeap"),(0,o.yg)("p",null,'P2P related application can be memory intensive, setting the optional android:largeHeap="true" flag in the AndroidManifest.xml file is recommended to ensure that your application has enough heap memory allocated.'),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-xml"},'<application\n  ...\n  android:largeHeap="true"\n  ...\n    />\n')),(0,o.yg)("h3",{id:"proguard-configuration"},"Proguard Configuration"),(0,o.yg)("p",null,"Please add the following code in proguard-rules.pro:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},"-dontwarn com.p2pengine.**\n-keep class com.p2pengine.**{*;}\n-keep interface com.p2pengine.**{*;}\n-keep class com.cdnbye.libdc.**{*;}\n-keep interface com.cdnbye.libdc.**{*;}\n-keep class com.snapchat.djinni.**{*;}\n")),(0,o.yg)("h2",{id:"import-sdk"},"Import SDK"),(0,o.yg)(r.A,{groupId:"android",mdxType:"Tabs"},(0,o.yg)(t.A,{value:"maven",label:"By Mavel",mdxType:"TabItem"},(0,o.yg)("p",null,"To integrate the SDK, first set up the SwarmCloud Maven repository in the project's build.gradle file:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},"allprojects {\n    repositories {\n        // ... other repositories\n        maven {\n            url 'https://maven.swarmcloud.net/repository/maven-releases/'\n        }\n    }\n}\n")),(0,o.yg)("p",null,"Then add the following sentence inside the dependencies section of the module's build.gradle file:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},'dependencies {\n    implementation("com.squareup.okhttp3:okhttp:3.12.13")    // Or any okhttp newer version\n    implementation("com.orhanobut:logger:2.2.0")\n    implementation("com.google.code.gson:gson:2.9.0")\n    implementation("com.swarmcloud:datachannel_native:latest.release")\n    implementation("com.swarmcloud:p2p_engine:latest.release")\n}\n'))),(0,o.yg)(t.A,{value:"local",label:"By Local File",mdxType:"TabItem"},(0,o.yg)("p",null,"Download the latest version SDK ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/cdnbye/android-p2p-engine/releases"},"swarmcloud.jar and datachannel.aar"),", then copy it to ",(0,o.yg)("strong",{parentName:"p"},(0,o.yg)("em",{parentName:"strong"},"app/libs"))," ."),(0,o.yg)("p",null,"Besides add new dependencies in module's build.gradle file as shown below:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},"dependencies {\n    implementation fileTree(dir: 'libs', include: ['*.aar', '*.jar'])\n    implementation(\"com.squareup.okhttp3:okhttp:3.12.13\")    // Or any okhttp newer version\n    implementation(\"com.orhanobut:logger:2.2.0\")\n    implementation(\"com.google.code.gson:gson:2.9.0\")\n}\n")))),(0,o.yg)("admonition",{type:"tip"},(0,o.yg)("p",{parentName:"admonition"},"Simulator may not work as expected, please test on real device.")),(0,o.yg)("h2",{id:"quick-start"},"Quick Start"),(0,o.yg)("p",null,"We recommend calling P2pEngine.initEngine in the instance of the Application class right after the application is created."),(0,o.yg)("h3",{id:"import-p2pengine"},"Import P2pEngine"),(0,o.yg)(r.A,{groupId:"android",mdxType:"Tabs"},(0,o.yg)(t.A,{value:"kotlin",label:"kotlin",mdxType:"TabItem"},(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-kotlin"},"import com.p2pengine.sdk.P2pEngine\n"))),(0,o.yg)(t.A,{value:"java",label:"java",mdxType:"TabItem"},(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-java"},"import com.p2pengine.sdk.P2pEngine;\n")))),(0,o.yg)("h3",{id:"initialize-p2pengine"},"Initialize P2pEngine"),(0,o.yg)(r.A,{groupId:"android",mdxType:"Tabs"},(0,o.yg)(t.A,{value:"kotlin",label:"kotlin",mdxType:"TabItem"},(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-kotlin"},"class MyApplication : Application() {\n    override fun onCreate() {\n        super.onCreate()\n        val config = P2pConfig.Builder()\n            .trackerZone(TrackerZone.Europe)      // Set HongKong or USA if you changed zone\n            .build()\n        P2pEngine.init(this, YOUR_TOKEN, config)\n    }\n}\n"))),(0,o.yg)(t.A,{value:"java",label:"java",mdxType:"TabItem"},(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-java"},"class MyApplication extends android.app.Application {\n    protected void onCreate() {\n        super.onCreate();\n        P2pConfig config = new P2pConfig.Builder()\n                .trackerZone(TrackerZone.Europe)    // Set HongKong or USA if you changed zone\n                .insertTimeOffsetTag(0.0)\n                .build();\n        P2pEngine.init(this, YOUR_TOKEN, config);\n    }\n}\n")))),(0,o.yg)("p",null,"Where YOUR_TOKEN is your Customer ID. Please replace it by your own token obtained from console, click ",(0,o.yg)("a",{parentName:"p",href:"/guides/getting-started#for-mobile-app-integration"},"here")," for more information."),(0,o.yg)("h3",{id:"playback-address"},"Playback Address"),(0,o.yg)("p",null,"When initializing a media player (or any other video player) instance, before passing it a URL, pass that URL through P2P Engine."),(0,o.yg)(r.A,{groupId:"android",mdxType:"Tabs"},(0,o.yg)(t.A,{value:"kotlin",label:"kotlin",mdxType:"TabItem"},(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-kotlin"},"private void onPlay(){\n  val parsedUrl = P2pEngine.instance!!.parseStreamUrl(YOUR_STREAM)\n  mediaPlayer.play(parsedUrl)\n}\n"))),(0,o.yg)(t.A,{value:"java",label:"java",mdxType:"TabItem"},(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-java"},"private void onPlay(){\n  String parsedUrl = P2pEngine.getInstance().parseStreamUrl(YOUR_STREAM);\n  mediaPlayer.play(parsedUrl);\n}\n")))),(0,o.yg)("h3",{id:"setup-player-interactor-for-exoplayer"},"Setup Player Interactor For Exoplayer"),(0,o.yg)("p",null,"If your are using Exoplayer, it's recommended to setup PlayerInteractor for live streaming."),(0,o.yg)(r.A,{groupId:"android",mdxType:"Tabs"},(0,o.yg)(t.A,{value:"kotlin",label:"kotlin",mdxType:"TabItem"},(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-kotlin"},"P2pEngine.instance?.setPlayerInteractor(object : PlayerInteractor() {\n    override fun onBufferedDuration(): Long {\n        // Exoplayer in milliseconds\n        return if (player != null) {\n            player!!.bufferedPosition - player!!.currentPosition\n        } else {\n            -1\n        }\n    }\n})\n"))),(0,o.yg)(t.A,{value:"java",label:"java",mdxType:"TabItem"},(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-java"},"P2pEngine.getInstance().setPlayerInteractor(new PlayerInteractor() {\n    public long onBufferedDuration() {\n        // Exoplayer in milliseconds\n        if (play != null) {\n            return player.getBufferedPosition() - player.getCurrentPosition();\n        }\n        return -1;\n    }\n});\n")))),(0,o.yg)("h4",{id:"demo"},"Demo"),(0,o.yg)("p",null,"A completed example can be found ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/cdnbye/android-p2p-engine"},"here")),(0,o.yg)("h4",{id:"troubleshooting-steps-when-p2p-doesnt-work"},"Troubleshooting Steps when P2P doesn't work"),(0,o.yg)("p",null,"Click ",(0,o.yg)("a",{parentName:"p",href:"/guides/troubleshooting#troubleshooting-steps-of-mobile-sdk"},"here")))}f.isMDXComponent=!0}}]);