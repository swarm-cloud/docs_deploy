"use strict";(self.webpackChunkswarmcloud_docs=self.webpackChunkswarmcloud_docs||[]).push([[4704],{114:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>g,default:()=>y,frontMatter:()=>s,metadata:()=>l,toc:()=>d});n(6540);var r=n(5680);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const s={title:"API & Config",sidebar_position:4},g=void 0,l={unversionedId:"API",id:"API",title:"API & Config",description:"P2pEngineHls API",source:"@site/docs/web-hls/API.mdx",sourceDirName:".",slug:"/API",permalink:"/home/web-hls/API",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"API & Config",sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Player Integration",permalink:"/home/web-hls/players"},next:{title:"CDN",permalink:"/home/web-hls/CDN"}},p={},d=[{value:"P2pEngineHls API",id:"p2penginehls-api",level:2},{value:"<strong><em>var engine = new P2pEngineHls(p2pConfig);</em></strong>",id:"var-engine--new-p2penginehlsp2pconfig",level:3},{value:"P2pEngineHls Properties and Methods",id:"p2penginehls-properties-and-methods",level:2},{value:"<strong><em>P2pEngineHls.version</em></strong> (static)",id:"p2penginehlsversion-static",level:3},{value:"<strong><em>P2pEngineHls.protocolVersion</em></strong> (static)",id:"p2penginehlsprotocolversion-static",level:4},{value:"<strong><em>P2pEngineHls.HlsjsEngine (static)</em></strong>",id:"p2penginehlshlsjsengine-static",level:4},{value:"<strong><em>P2pEngineHls.ServiceWorkerEngine (static)</em></strong>",id:"p2penginehlsserviceworkerengine-static",level:4},{value:"<strong><em>P2pEngineHls.tryRegisterServiceWorker(config) (static)</em></strong>",id:"p2penginehlstryregisterserviceworkerconfig-static",level:4},{value:"<strong><em>P2pEngineHls.getBrowser()</em></strong> (static)",id:"p2penginehlsgetbrowser-static",level:4},{value:"<strong><em>P2pEngineHls.isSupported()</em></strong> (static method)",id:"p2penginehlsissupported-static-method",level:3},{value:"<strong><em>P2pEngineHls.isMSESupported() (static)</em></strong>",id:"p2penginehlsismsesupported-static",level:4},{value:"<strong><em>P2pEngineHls.isSeviceWorkerSupported() (static)</em></strong>",id:"p2penginehlsisseviceworkersupported-static",level:4},{value:"<strong><em>engine.realEngine</em></strong>",id:"enginerealengine",level:3},{value:"<strong><em>engine.engineName</em></strong>",id:"engineenginename",level:3},{value:"<strong><em>engine.enableP2P()</em></strong>",id:"engineenablep2p",level:3},{value:"<strong><em>engine.disableP2P()</em></strong>",id:"enginedisablep2p",level:3},{value:"<strong><em>engine.destroy()</em></strong>",id:"enginedestroy",level:3},{value:"<strong><em>engine.registerServiceWorker()</em></strong>",id:"engineregisterserviceworker",level:3},{value:"<strong><em>engine.unregisterServiceWorker()</em></strong>",id:"engineunregisterserviceworker",level:3},{value:"P2pEngineHls Events",id:"p2penginehls-events",level:2},{value:"<strong><em>engine.on(&#39;peerId&#39;, function (peerId) {})</em></strong>",id:"engineonpeerid-function-peerid-",level:4},{value:"<strong><em>engine.on(&#39;peers&#39;, function (peers) {})</em></strong>",id:"engineonpeers-function-peers-",level:4},{value:"<strong><em>engine.on(&#39;stats&#39;, function (stats) {})</em></strong>",id:"engineonstats-function-stats-",level:4},{value:"<strong><em>engine.on(&#39;serverConnected&#39;, function (connected) {})</em></strong>",id:"engineonserverconnected-function-connected-",level:3},{value:"<strong><em>engine.on(&#39;exception&#39;, function (e) {})</em></strong>",id:"engineonexception-function-e-",level:3},{value:"Get p2p information from p2pConfig",id:"get-p2p-information-from-p2pconfig",level:3},{value:"New API for Hls.js",id:"new-api-for-hlsjs",level:2},{value:"<strong><em>Hls.engineVersion</em></strong> (static method)",id:"hlsengineversion-static-method",level:3},{value:"<strong><em>Hls.WEBRTC_SUPPORT</em></strong> (static method)",id:"hlswebrtc_support-static-method",level:3},{value:"<strong><em>Hls.P2pEngine</em></strong> (static method)",id:"hlsp2pengine-static-method",level:3},{value:"Create Hls Instance",id:"create-hls-instance",level:2},{value:"<strong><em>var hls = new Hls({p2pConfig: opts});</em></strong>",id:"var-hls--new-hlsp2pconfig-opts",level:3},{value:"<strong><em>hls.p2pEngine</em></strong>",id:"hlsp2pengine",level:3},{value:"HlsProxy API",id:"hlsproxy-api",level:2},{value:"new HlsProxy(config);",id:"new-hlsproxyconfig",level:4},{value:"<strong><em>HlsProxy.version</em></strong> (static)",id:"hlsproxyversion-static",level:4},{value:"Advanced Usage",id:"advanced-usage",level:2},{value:"Dynamic M3u8 Path Support",id:"dynamic-m3u8-path-support",level:3},{value:"Allow Http Range Request",id:"allow-http-range-request",level:3},{value:"Bypass User-specific Segments",id:"bypass-user-specific-segments",level:3},{value:"Specify the Preferred Point in the Video to Start Playback.",id:"specify-the-preferred-point-in-the-video-to-start-playback",level:3},{value:"How to Support Other Url Suffix in sw.js",id:"how-to-support-other-url-suffix-in-swjs",level:3},{value:"Use Your Own STUN or TURN Server",id:"use-your-own-stun-or-turn-server",level:3},{value:"How to Check Segment Validity",id:"how-to-check-segment-validity",level:3}],m={toc:d},c="wrapper";function y(e){var{components:t}=e,n=o(e,["components"]);return(0,r.yg)(c,i(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}({},m,n),{components:t,mdxType:"MDXLayout"}),(0,r.yg)("h2",{id:"p2penginehls-api"},"P2pEngineHls API"),(0,r.yg)("h3",{id:"var-engine--new-p2penginehlsp2pconfig"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"var engine = new P2pEngineHls(p2pConfig);"))),(0,r.yg)("p",null,"Create a new ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("em",{parentName:"strong"},"P2pEngineHls"))," instance."),(0,r.yg)("p",null,"If ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("em",{parentName:"strong"},"p2pConfig"))," is specified, then the default options (shown below) will be overridden."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"center"},"Field"),(0,r.yg)("th",{parentName:"tr",align:"center"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"center"},"Default"),(0,r.yg)("th",{parentName:"tr",align:"center"},"Description"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"hlsjsInstance"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"Hlsjs"),(0,r.yg)("td",{parentName:"tr",align:"center"},"null"),(0,r.yg)("td",{parentName:"tr",align:"center"},"If the instance of hlsjs is not passed in, the hlsjs based engine will not be enabled.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"proxyOnly"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"boolean"),(0,r.yg)("td",{parentName:"tr",align:"center"},"false"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Force to enable ServiceWorker based engine.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"logLevel"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"string","|","boolean"),(0,r.yg)("td",{parentName:"tr",align:"center"},"'error'"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Print log level(warn, error, none, false=none, true=warn).")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"token"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"string"),(0,r.yg)("td",{parentName:"tr",align:"center"},"undefined"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Token is used to summarize and display multi domain name data on the console. In addition, token is required while customizing channelId.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"live"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"boolean"),(0,r.yg)("td",{parentName:"tr",align:"center"},"true"),(0,r.yg)("td",{parentName:"tr",align:"center"},"tell engine whether in live or VOD mode.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"trackerZone"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"string"),(0,r.yg)("td",{parentName:"tr",align:"center"},"'eu'"),(0,r.yg)("td",{parentName:"tr",align:"center"},"The country code name of the tracker server address('eu', 'hk', 'us').")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"memoryCacheLimit"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"Object"),(0,r.yg)("td",{parentName:"tr",align:"center"},'{"pc": 400 ',"*"," 1024 ","*",' 1024, "mobile": 100 ',"*"," 1024 ","*"," 1024}"),(0,r.yg)("td",{parentName:"tr",align:"center"},"The max size of binary data that can be stored in the memory cache.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"p2pEnabled"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"boolean"),(0,r.yg)("td",{parentName:"tr",align:"center"},"true"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Enable or disable p2p engine.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"webRTCConfig"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"Object"),(0,r.yg)("td",{parentName:"tr",align:"center"},"{}"),(0,r.yg)("td",{parentName:"tr",align:"center"},"A ",(0,r.yg)("a",{parentName:"td",href:"https://github.com/feross/simple-peer"},"Configuration dictionary")," providing options to configure WebRTC connections.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"useHttpRange"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"boolean"),(0,r.yg)("td",{parentName:"tr",align:"center"},"true"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Use HTTP ranges requests where it is possible. Allows to continue (and not start over) aborted P2P downloads over HTTP.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"sharePlaylist"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"boolean"),(0,r.yg)("td",{parentName:"tr",align:"center"},"false"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Allow the P2P transmission of m3u8 file.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"strictSegmentId"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"boolean"),(0,r.yg)("td",{parentName:"tr",align:"center"},"false"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Use segment url based segment id instead of sequence number based one.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"swAutoRegister"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"boolean"),(0,r.yg)("td",{parentName:"tr",align:"center"},"true"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Whether to automatically register serviceworker after initializing the engine based on serviceworker.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"swFile"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"string"),(0,r.yg)("td",{parentName:"tr",align:"center"},"'./sw.js'"),(0,r.yg)("td",{parentName:"tr",align:"center"},"The file name and path of ServiceWorker.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"swScope"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"string"),(0,r.yg)("td",{parentName:"tr",align:"center"},"'./'"),(0,r.yg)("td",{parentName:"tr",align:"center"},"The default scope is the location of the ServiceWorker file, and extends to all directories below. So if sw.js is located in the root directory, the ServiceWorker will control requests from all files at this domain.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"mediaElem"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"HTMLMediaElement","|","string"),(0,r.yg)("td",{parentName:"tr",align:"center"},"undefined"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Specify the ID or element object of the media tag, default value is the first video or audio element in the document tree.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"useDiskCache"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"boolean"),(0,r.yg)("td",{parentName:"tr",align:"center"},"true"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Use IndexedDB to cache data for VOD streaming.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"diskCacheLimit"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"Object"),(0,r.yg)("td",{parentName:"tr",align:"center"},'{"pc": 1500 ',"*"," 1024 ","*",' 1024, "mobile": 1000 ',"*"," 1024 ","*"," 1024}"),(0,r.yg)("td",{parentName:"tr",align:"center"},"The max size of binary data that can be stored in the disk cache.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"prefetchOnly"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"boolean"),(0,r.yg)("td",{parentName:"tr",align:"center"},"false"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Only use prefetch strategy in p2p downloading.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},(0,r.yg)("strong",{parentName:"td"},(0,r.yg)("em",{parentName:"strong"},"startFromSegmentOffset"))),(0,r.yg)("td",{parentName:"tr",align:"center"},"number"),(0,r.yg)("td",{parentName:"tr",align:"center"},"3"),(0,r.yg)("td",{parentName:"tr",align:"center"},"The segment offset that start to connect to tracker server.")))),(0,r.yg)("h2",{id:"p2penginehls-properties-and-methods"},"P2pEngineHls Properties and Methods"),(0,r.yg)("h3",{id:"p2penginehlsversion-static"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"P2pEngineHls.version"))," (static)"),(0,r.yg)("p",null,"Get the version of SDK."),(0,r.yg)("h4",{id:"p2penginehlsprotocolversion-static"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"P2pEngineHls.protocolVersion"))," (static)"),(0,r.yg)("p",null,"Get the version of P2P protocol."),(0,r.yg)("h4",{id:"p2penginehlshlsjsengine-static"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"P2pEngineHls.HlsjsEngine (static)"))),(0,r.yg)("p",null,"Get the constructor of Hlsjs based P2pEngine."),(0,r.yg)("h4",{id:"p2penginehlsserviceworkerengine-static"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"P2pEngineHls.ServiceWorkerEngine (static)"))),(0,r.yg)("p",null,"Get the constructor of ServiceWorker based P2pEngine."),(0,r.yg)("h4",{id:"p2penginehlstryregisterserviceworkerconfig-static"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"P2pEngineHls.tryRegisterServiceWorker(config) (static)"))),(0,r.yg)("p",null,"Static method to register ServiceWorker, if ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("em",{parentName:"strong"},"config"))," is specified, then the default options (shown below) will be overridden."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"center"},"Field"),(0,r.yg)("th",{parentName:"tr",align:"center"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"center"},"Default"),(0,r.yg)("th",{parentName:"tr",align:"center"},"Description"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"swFile"),(0,r.yg)("td",{parentName:"tr",align:"center"},"string"),(0,r.yg)("td",{parentName:"tr",align:"center"},"'./sw.js'"),(0,r.yg)("td",{parentName:"tr",align:"center"},"The file name and path of ServiceWorker.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"swScope"),(0,r.yg)("td",{parentName:"tr",align:"center"},"string"),(0,r.yg)("td",{parentName:"tr",align:"center"},"'./'"),(0,r.yg)("td",{parentName:"tr",align:"center"},"The default scope is the location of the ServiceWorker file.")))),(0,r.yg)("h4",{id:"p2penginehlsgetbrowser-static"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"P2pEngineHls.getBrowser()"))," (static)"),(0,r.yg)("p",null,"Get the name of the browser. The possible values are as follows:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Chrome"),(0,r.yg)("li",{parentName:"ul"},"Firefox"),(0,r.yg)("li",{parentName:"ul"},"Mac-Safari"),(0,r.yg)("li",{parentName:"ul"},"iOS-Safari"),(0,r.yg)("li",{parentName:"ul"},"X5"),(0,r.yg)("li",{parentName:"ul"},"Unknown")),(0,r.yg)("h3",{id:"p2penginehlsissupported-static-method"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"P2pEngineHls.isSupported()"))," (static method)"),(0,r.yg)("p",null,"Returns true if both WebRTC Data Channel and one of MSE or SeviceWorker are supported."),(0,r.yg)("h4",{id:"p2penginehlsismsesupported-static"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"P2pEngineHls.isMSESupported() (static)"))),(0,r.yg)("p",null,"Returns true if MEDIA SOURCE EXTENSIONS(MSE) is supported by the browser."),(0,r.yg)("h4",{id:"p2penginehlsisseviceworkersupported-static"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"P2pEngineHls.isSeviceWorkerSupported() (static)"))),(0,r.yg)("p",null,"Returns true if ServiceWorker is supported by the browser."),(0,r.yg)("h3",{id:"enginerealengine"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"engine.realEngine"))),(0,r.yg)("p",null,"Gets the currently working engine instance."),(0,r.yg)("h3",{id:"engineenginename"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"engine.engineName"))),(0,r.yg)("p",null,"Get the name of the currently working engine instance. The possible values are as follows:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"HlsjsP2pEngine"),(0,r.yg)("li",{parentName:"ul"},"HlsSwP2pEngine")),(0,r.yg)("h3",{id:"engineenablep2p"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"engine.enableP2P()"))),(0,r.yg)("p",null,"Start p2p."),(0,r.yg)("h3",{id:"enginedisablep2p"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"engine.disableP2P()"))),(0,r.yg)("p",null,"Stop p2p, free used resources."),(0,r.yg)("h3",{id:"enginedestroy"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"engine.destroy()"))),(0,r.yg)("p",null,"Stop p2p and free used resources."),(0,r.yg)("h3",{id:"engineregisterserviceworker"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"engine.registerServiceWorker()"))),(0,r.yg)("p",null,"Register ServiceWorker and return a promise."),(0,r.yg)("h3",{id:"engineunregisterserviceworker"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"engine.unregisterServiceWorker()"))),(0,r.yg)("p",null,"Unregister ServiceWorker and return a promise."),(0,r.yg)("h2",{id:"p2penginehls-events"},"P2pEngineHls Events"),(0,r.yg)("h4",{id:"engineonpeerid-function-peerid-"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"engine.on('peerId', function (peerId) {})"))),(0,r.yg)("p",null,"Emitted when the peer Id of this client is obtained from server."),(0,r.yg)("h4",{id:"engineonpeers-function-peers-"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"engine.on('peers', function (peers) {})"))),(0,r.yg)("p",null,"Emitted when successfully connected with new peer."),(0,r.yg)("h4",{id:"engineonstats-function-stats-"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"engine.on('stats', function (stats) {})"))),(0,r.yg)("p",null,"Emitted when data is downloaded/uploaded.",(0,r.yg)("br",null),"\nstats.totalHTTPDownloaded: total data downloaded by HTTP(KB).",(0,r.yg)("br",null),"\nstats.totalP2PDownloaded: total data downloaded by P2P(KB).",(0,r.yg)("br",null),"\nstats.totalP2PUploaded: total data uploaded by P2P(KB).",(0,r.yg)("br",null),"\nstats.p2pDownloadSpeed: p2p download speed(KB/s)."),(0,r.yg)("h3",{id:"engineonserverconnected-function-connected-"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"engine.on('serverConnected', function (connected) {})"))),(0,r.yg)("p",null,"Emitted when websocket is opened/closed."),(0,r.yg)("h3",{id:"engineonexception-function-e-"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"engine.on('exception', function (e) {})"))),(0,r.yg)("p",null,"Emitted when exception occured.",(0,r.yg)("br",null),"\ne.code: Exception identifier\uff08TRACKER_EXPT SIGNAL_EXPT\uff09",(0,r.yg)("br",null),"\ne.message: Exception message ",(0,r.yg)("br",null),"\ne.stack: Exception stack ",(0,r.yg)("br",null)),(0,r.yg)("h3",{id:"get-p2p-information-from-p2pconfig"},"Get p2p information from p2pConfig"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},"p2pConfig: {\n    getStats: function (totalP2PDownloaded, totalP2PUploaded, totalHTTPDownloaded, p2pDownloadSpeed) {\n        // get the downloading statistics\n    },\n    getPeerId: function (peerId) {\n        // get peer Id\n    },\n    getPeersInfo: function (peers) {\n        // get peers information\n    },\n    onHttpDownloaded: function (traffic) {\n        // listen to http downloaded traffic\n    },\n    onP2pDownloaded: function (traffic, speed) {\n        // listen to p2p downloaded traffic\n    },\n    onP2pUploaded: function (traffic) {\n        // listen to p2p uploaded traffic\n    },\n}\n")),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"The unit of download and upload is KB.\nThe unit of download speed is KB/s.")),(0,r.yg)("h2",{id:"new-api-for-hlsjs"},"New API for Hls.js"),(0,r.yg)("h3",{id:"hlsengineversion-static-method"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"Hls.engineVersion"))," (static method)"),(0,r.yg)("p",null,"Show the current version of SDK."),(0,r.yg)("h3",{id:"hlswebrtc_support-static-method"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"Hls.WEBRTC_SUPPORT"))," (static method)"),(0,r.yg)("p",null,"Is WebRTC natively supported in the environment?"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},"if (Hls.WEBRTC_SUPPORT) {\n    // WebRTC is supported\n} else {\n    // Use a fallback\n}\n")),(0,r.yg)("h3",{id:"hlsp2pengine-static-method"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"Hls.P2pEngine"))," (static method)"),(0,r.yg)("p",null,"Get P2pEngineHls class from Hls, which is equivalent to the directly introduced P2pEngineHls."),(0,r.yg)("h2",{id:"create-hls-instance"},"Create Hls Instance"),(0,r.yg)("h3",{id:"var-hls--new-hlsp2pconfig-opts"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"var hls = new Hls({p2pConfig: ","[opts]","});"))),(0,r.yg)("p",null,"Create a new ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("em",{parentName:"strong"},"Hls"))," instance, where p2pConfig is equivalent to the p2pConfig passed to P2pEngineHls. At this time, there is no need to specify hlsjsInstance."),(0,r.yg)("h3",{id:"hlsp2pengine"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"hls.p2pEngine"))),(0,r.yg)("p",null,"Get the instance of ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("em",{parentName:"strong"},"P2pEngineHls"))," from ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("em",{parentName:"strong"},"Hls"))," ."),(0,r.yg)("h2",{id:"hlsproxy-api"},"HlsProxy API"),(0,r.yg)("h4",{id:"new-hlsproxyconfig"},"new HlsProxy(config);"),(0,r.yg)("p",null,"Create a new ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("em",{parentName:"strong"},"HlsProxy"))," instance."),(0,r.yg)("p",null,"If ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("em",{parentName:"strong"},"config"))," is specified, then the default options (shown below) will be overridden."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"center"},"Field"),(0,r.yg)("th",{parentName:"tr",align:"center"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"center"},"Default"),(0,r.yg)("th",{parentName:"tr",align:"center"},"Description"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"httpHeadersForPlaylist"),(0,r.yg)("td",{parentName:"tr",align:"center"},"function(url, headers, originalHeaders)"),(0,r.yg)("td",{parentName:"tr",align:"center"},"null"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Set http headers for m3u8 request, for example, httpHeadersForPlaylist: (url, headers) => { headers.set('token', 'xxx') }")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"httpHeadersForMediaFile"),(0,r.yg)("td",{parentName:"tr",align:"center"},"function(url, headers, originalHeaders)"),(0,r.yg)("td",{parentName:"tr",align:"center"},"null"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Set http headers for ts request, for example, httpHeadersForMediaFile: (url, headers) => { headers.set('token', 'xxx') }")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"insertTimeOffsetTag"),(0,r.yg)("td",{parentName:"tr",align:"center"},"boolean"),(0,r.yg)("td",{parentName:"tr",align:"center"},"false"),(0,r.yg)("td",{parentName:"tr",align:"center"},'Insert "#ext-x-start: time-offset = ',"[playlistTimeOffset]",'" in m3u8 file to force the player to start loading from the first ts of playlist, only works on live mode')),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"playlistTimeOffset"),(0,r.yg)("td",{parentName:"tr",align:"center"},"number"),(0,r.yg)("td",{parentName:"tr",align:"center"},"0.01"),(0,r.yg)("td",{parentName:"tr",align:"center"},"The offset in seconds to start playing the video. If the value is negative, specifies the time from the end of the playlist. The offset must not be larger than the playlist duration, only works when insertTimeOffsetTag is true")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"allowedMediaFiles"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Array"),(0,r.yg)("td",{parentName:"tr",align:"center"},"['ts', 'mp4', 'm4s', 'fmp4']"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Additional media file extension (eg. ","['txt', 'png']",") that need to be intercepted, use ","['*']"," if no extension")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"mediaFileSeparator"),(0,r.yg)("td",{parentName:"tr",align:"center"},"String"),(0,r.yg)("td",{parentName:"tr",align:"center"},"'.'"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Separator that used to identify media file suffix")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"allowedPlaylistSuffix"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Array"),(0,r.yg)("td",{parentName:"tr",align:"center"},"['m3u8']"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Additional playlist file extension (eg. ","['txt']",") that need to be intercepted")))),(0,r.yg)("h4",{id:"hlsproxyversion-static"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"HlsProxy.version"))," (static)"),(0,r.yg)("p",null,"Get the version of HlsProxy."),(0,r.yg)("h2",{id:"advanced-usage"},"Advanced Usage"),(0,r.yg)("h3",{id:"dynamic-m3u8-path-support"},"Dynamic M3u8 Path Support"),(0,r.yg)("p",null,"The channelId is an identifier used by our backend to match peers that are watching the same content. It is an optional parameter, and by default, we generate channelId from the content URL by removing any query parameters and protocol from it.\nSome m3u8 urls play the same live/vod but have different paths on them. For example, example.com/clientId1/streamId.m3u8 and example.com/clientId2/streamId.m3u8. In this case, you can format a common channelId for them."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},"// Set token in p2pConfig before setting channelId! Connectivity with other platform should have the same token and channelId.\np2pConfig: {\n    token: YOUR_TOKEN,\n    channelId: function (m3u8Url) {\n        const videoId = extractVideoIdFromUrl(m3u8Url);   // make a channelId by removing the different part which is defined by yourself\n        return videoId;\n    }\n    // channelId: VIDEO_ID       // for fixed channel id\n}\n")),(0,r.yg)("p",null,"Let's say your m3u8 is ",(0,r.yg)("a",{parentName:"p",href:"http://example.com/token123456/video1/playlist.m3u8"},"http://example.com/token123456/video1/playlist.m3u8"),", in which token123456 is the token varied by users, video1 is the ID of the video."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},"p2pConfig: {\n    token: YOUR_TOKEN,\n    channelId: function (m3u8Url) {\n        var parts = m3u8Url.split('/');\n        var videoId = parts[parts.length-2]+'/'+parts[parts.length-1];\n        return videoId;\n    }\n}\n")),(0,r.yg)("p",null,"The following is an example of the client behaviour with this channelId configured:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"\x3c!-- URL to be replaced --\x3e\nhttp://example.com/token123456/video1/playlist.m3u8\n\n\x3c!-- Resulting channelId --\x3e\nvideo1/playlist.m3u8\n")),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"Interconnect with other platform should ensure that both have the same token and channelId.")),(0,r.yg)("h3",{id:"allow-http-range-request"},"Allow Http Range Request"),(0,r.yg)("p",null,"If http range request is activated, we are able to get chunks of data from peer and then complete the segments by getting other chunks from the CDN, thus, reducing your CDN bandwidth. To activate range requests, See ",(0,r.yg)("a",{parentName:"p",href:"/guides/optimization#allow-http-range-request"},"Allow Http Range Request"),". Besides, the code below is needed\uff1a"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},"p2pConfig: {\n    useHttpRange: true,\n}\n")),(0,r.yg)("h3",{id:"bypass-user-specific-segments"},"Bypass User-specific Segments"),(0,r.yg)("p",null,"Sometimes we don't want some ts files to be shared, such as user-specific ts generated by SSAI (Server Side Ad Insertion). At this time, we can use the segmentBypass function to bypass it:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},"p2pConfig: {\n    segmentBypass: (url, tags) => {\n        return isSSAISegment(url)\n    },\n}\n")),(0,r.yg)("h3",{id:"specify-the-preferred-point-in-the-video-to-start-playback"},"Specify the Preferred Point in the Video to Start Playback."),(0,r.yg)("p",null,"The SDK can insert the ",(0,r.yg)("a",{parentName:"p",href:"https://hlsbook.net/how-to-start-playing-a-video-at-a-specific-point-in-time/"},"EXT-X-START tag")," to start playing a live stream from the start point in time of playlist, however, it may bring more delay to the stream:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},"// sw.js\nself.importScripts('https://cdn.jsdelivr.net/npm/@swarmcloud/hls/hls-proxy.js')\nnew HlsProxy({\n    insertTimeOffsetTag: true,\n    playlistTimeOffset: 0.01,\n})\n")),(0,r.yg)("h3",{id:"how-to-support-other-url-suffix-in-swjs"},"How to Support Other Url Suffix in sw.js"),(0,r.yg)("p",null,"For sw.js, the default supported suffix of playlist is m3u8, the default supported suffix of media file is ts, mp4, m4s and fmp4, if other suffix type is needed, you can customize config:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},"self.importScripts('https://cdn.jsdelivr.net/npm/@swarmcloud/hls/hls-proxy.js')\nnew HlsProxy({\n    allowedPlaylistSuffix: ['m3u8', 'html'],     // if your playlist url is xxx.html\n    allowedMediaFiles: ['ts', 'mp4', 'm4s', 'fmp4', 'jpg']  // if your media file url is xxx.jpg\n    // allowedMediaFiles: ['*']   // if no extension\n})\n")),(0,r.yg)("h3",{id:"use-your-own-stun-or-turn-server"},"Use Your Own STUN or TURN Server"),(0,r.yg)("p",null,"STUN (Session Traversal Utilities for NAT) allows clients to discover their public IP address and the type of NAT they are behind. This information is used to establish the media connection. Although there are default STUN servers in this SDK, you can replace them with your own via P2PConfig. TURN (Traversal Using Relays around NAT) server is used to relay traffic if direct connection fails. You can config your ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/coturn/coturn"},"TURN")," server in the same way as STUN."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},"p2pConfig: {\n    webRTCConfig: {\n       iceServers: [\n           { urls: YOUR_STUN_OR_TURN_SERVER }\n       ]\n    }\n}\n")),(0,r.yg)("h3",{id:"how-to-check-segment-validity"},"How to Check Segment Validity"),(0,r.yg)("p",null,"Sometimes we need to prevent a peer from sending a fake segment\n(such as the bittorrent with a hash function).\nCDNBye provides a validation callback with buffer of the\ndownloaded segment, developer should implement the actual\nvalidator. For example, you can create a program that generates\nhashes for the segments and stores them in a specific file or\ninjects into m3u8 playlist files the hashes information. If\nthe callback returns false, then the segment is not valid."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},"p2pConfig: {\n   validateSegment: function (segId, buffer) {\n       var hash = hashFile.getHash(segId);\n       return hash === md5(buffer);\n   }\n}\n")))}y.isMDXComponent=!0},5680:(e,t,n)=>{n.d(t,{xA:()=>p,yg:()=>y});var r=n(6540);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var g=r.createContext({}),l=function(e){var t=r.useContext(g),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(g.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef(function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,g=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=l(n),c=a,y=d["".concat(g,".").concat(c)]||d[c]||m[c]||i;return n?r.createElement(y,o(o({ref:t},p),{},{components:n})):r.createElement(y,o({ref:t},p))});function y(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=c;var s={};for(var g in t)hasOwnProperty.call(t,g)&&(s[g]=t[g]);s.originalType=e,s[d]="string"==typeof e?e:a,o[1]=s;for(var l=2;l<i;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"}}]);