"use strict";(self.webpackChunkswarmcloud_docs=self.webpackChunkswarmcloud_docs||[]).push([[1349],{5400:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>g,default:()=>y,frontMatter:()=>p,metadata:()=>l,toc:()=>s});t(6540);var r=t(5680);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}),e}function o(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}const p={title:"API & Config",sidebar_position:3},g=void 0,l={unversionedId:"API",id:"API",title:"API & Config",description:"Create P2PEngineMedia instance",source:"@site/docs/media/API.mdx",sourceDirName:".",slug:"/API",permalink:"/home/media/API",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"API & Config",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Usage",permalink:"/home/media/"}},d={},s=[{value:"Create P2PEngineMedia instance",id:"create-p2penginemedia-instance",level:2},{value:"var engine = new P2PEngineMedia(p2pConfig);",id:"var-engine--new-p2penginemediap2pconfig",level:3},{value:"P2PEngineMedia API",id:"p2penginemedia-api",level:2},{value:"<strong><em>P2PEngineMedia.version</em></strong> (static)",id:"p2penginemediaversion-static",level:4},{value:"<strong><em>P2PEngineMedia.protocolVersion</em></strong> (static)",id:"p2penginemediaprotocolversion-static",level:4},{value:"<strong><em>P2PEngineMedia.isSupported() (static)</em></strong>",id:"p2penginemediaissupported-static",level:4},{value:"<strong><em>P2PEngineMedia.isWebRTCSupported() (static)</em></strong>",id:"p2penginemediaiswebrtcsupported-static",level:4},{value:"<strong><em>P2PEngineMedia.isSeviceWorkerSupported() (static)</em></strong>",id:"p2penginemediaisseviceworkersupported-static",level:4},{value:"<strong><em>engine.getProxiedUrl(originalURL)</em></strong>",id:"enginegetproxiedurloriginalurl",level:4},{value:"<strong><em>engine.enableP2P()</em></strong>",id:"engineenablep2p",level:4},{value:"<strong><em>engine.disableP2P()</em></strong>",id:"enginedisablep2p",level:4},{value:"<strong><em>engine.restartP2p()</em></strong>",id:"enginerestartp2p",level:4},{value:"P2PEngineMedia Events",id:"p2penginemedia-events",level:2},{value:"<strong><em>engine.on(&#39;peerId&#39;, function (peerId) {})</em></strong>",id:"engineonpeerid-function-peerid-",level:4},{value:"<strong><em>engine.on(&#39;peers&#39;, function (peers) {})</em></strong>",id:"engineonpeers-function-peers-",level:4},{value:"<strong><em>engine.on(&#39;stats&#39;, function (stats) {})</em></strong>",id:"engineonstats-function-stats-",level:4},{value:"<strong><em>engine.on(&#39;serverConnected&#39;, function (connected) {})</em></strong>",id:"engineonserverconnected-function-connected-",level:3},{value:"<strong><em>engine.on(&#39;exception&#39;, function (e) {})</em></strong>",id:"engineonexception-function-e-",level:3},{value:"Get p2p information from p2pConfig",id:"get-p2p-information-from-p2pconfig",level:3},{value:"<strong><em>MediaProxy.version</em></strong> (static)",id:"mediaproxyversion-static",level:4},{value:"Advanced Usage",id:"advanced-usage",level:2},{value:"Dynamic MP4/MP3 Path Support",id:"dynamic-mp4mp3-path-support",level:3}],c={toc:s},m="wrapper";function y(e){var{components:n}=e,t=o(e,["components"]);return(0,r.yg)(m,i(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.forEach(function(n){a(e,n,t[n])})}return e}({},c,t),{components:n,mdxType:"MDXLayout"}),(0,r.yg)("h2",{id:"create-p2penginemedia-instance"},"Create P2PEngineMedia instance"),(0,r.yg)("h3",{id:"var-engine--new-p2penginemediap2pconfig"},"var engine = new P2PEngineMedia(p2pConfig);"),(0,r.yg)("p",null,"Create a new ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("em",{parentName:"strong"},"P2PEngineMedia"))," instance."),(0,r.yg)("p",null,"If ",(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("em",{parentName:"strong"},"p2pConfig"))," is specified, then the default options (shown below) will be overridden."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"center"},"Field"),(0,r.yg)("th",{parentName:"tr",align:"center"},"Type"),(0,r.yg)("th",{parentName:"tr",align:"center"},"Default"),(0,r.yg)("th",{parentName:"tr",align:"center"},"Description"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"logLevel"),(0,r.yg)("td",{parentName:"tr",align:"center"},"string","|","boolean"),(0,r.yg)("td",{parentName:"tr",align:"center"},"'error'"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Print log level(warn, error, none, false=none, true=warn).")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"token"),(0,r.yg)("td",{parentName:"tr",align:"center"},"string"),(0,r.yg)("td",{parentName:"tr",align:"center"},"undefined"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Token is used to summarize and display multi domain name data on the console. In addition, token is required while customizing channelId.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"trackerZone"),(0,r.yg)("td",{parentName:"tr",align:"center"},"string"),(0,r.yg)("td",{parentName:"tr",align:"center"},"'eu'"),(0,r.yg)("td",{parentName:"tr",align:"center"},"The country code name of the tracker server address('eu', 'hk', 'us').")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"pieceLength"),(0,r.yg)("td",{parentName:"tr",align:"center"},"number"),(0,r.yg)("td",{parentName:"tr",align:"center"},"512 ","*"," 1024"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Length in bytes of every piece but the last one.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"mediaElem"),(0,r.yg)("td",{parentName:"tr",align:"center"},"HTMLMediaElement","|","string"),(0,r.yg)("td",{parentName:"tr",align:"center"},"undefined"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Specify the ID or element object of the video/audio tag, default value is the first video/audio element in the document tree.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"p2pEnabled"),(0,r.yg)("td",{parentName:"tr",align:"center"},"boolean"),(0,r.yg)("td",{parentName:"tr",align:"center"},"true"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Enable or disable p2p engine.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"webRTCConfig"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Object"),(0,r.yg)("td",{parentName:"tr",align:"center"},"{}"),(0,r.yg)("td",{parentName:"tr",align:"center"},"A ",(0,r.yg)("a",{parentName:"td",href:"https://github.com/feross/simple-peer"},"Configuration dictionary")," providing options to configure WebRTC connections.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"tag"),(0,r.yg)("td",{parentName:"tr",align:"center"},"string"),(0,r.yg)("td",{parentName:"tr",align:"center"},"''"),(0,r.yg)("td",{parentName:"tr",align:"center"},"User customized tag.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"swFile"),(0,r.yg)("td",{parentName:"tr",align:"center"},"string"),(0,r.yg)("td",{parentName:"tr",align:"center"},"'./sw.js'"),(0,r.yg)("td",{parentName:"tr",align:"center"},"The file name and path of ServiceWorker.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"swScope"),(0,r.yg)("td",{parentName:"tr",align:"center"},"string"),(0,r.yg)("td",{parentName:"tr",align:"center"},"'./'"),(0,r.yg)("td",{parentName:"tr",align:"center"},"The default scope is the location of the ServiceWorker file, and extends to all directories below. So if sw.js is located in the root directory, the ServiceWorker will control requests from all files at this domain.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"diskCacheLimit"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Object"),(0,r.yg)("td",{parentName:"tr",align:"center"},'{"pc": 1500 ',"*"," 1024 ","*",' 1024, "mobile": 1000 ',"*"," 1024 ","*"," 1024}"),(0,r.yg)("td",{parentName:"tr",align:"center"},"The max size of binary data that can be stored in the disk cache.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"minBufferCount"),(0,r.yg)("td",{parentName:"tr",align:"center"},"number"),(0,r.yg)("td",{parentName:"tr",align:"center"},"0"),(0,r.yg)("td",{parentName:"tr",align:"center"},"Minimum buffer count of pieces. If buffer pieces is/become less than this value, a new piece will be loaded.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"center"},"startFromSegmentOffset"),(0,r.yg)("td",{parentName:"tr",align:"center"},"number"),(0,r.yg)("td",{parentName:"tr",align:"center"},"3"),(0,r.yg)("td",{parentName:"tr",align:"center"},"The segment offset that start to connect to tracker server.")))),(0,r.yg)("h2",{id:"p2penginemedia-api"},"P2PEngineMedia API"),(0,r.yg)("h4",{id:"p2penginemediaversion-static"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"P2PEngineMedia.version"))," (static)"),(0,r.yg)("p",null,"Get the version of P2PEngineMedia."),(0,r.yg)("h4",{id:"p2penginemediaprotocolversion-static"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"P2PEngineMedia.protocolVersion"))," (static)"),(0,r.yg)("p",null,"Get the version of P2P protocol."),(0,r.yg)("h4",{id:"p2penginemediaissupported-static"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"P2PEngineMedia.isSupported() (static)"))),(0,r.yg)("p",null,"Returns true if both WebRTC datachannel and ServiceWorker are supported by the browser."),(0,r.yg)("h4",{id:"p2penginemediaiswebrtcsupported-static"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"P2PEngineMedia.isWebRTCSupported() (static)"))),(0,r.yg)("p",null,"Returns true if WebRTC datachannel is supported by the browser."),(0,r.yg)("h4",{id:"p2penginemediaisseviceworkersupported-static"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"P2PEngineMedia.isSeviceWorkerSupported() (static)"))),(0,r.yg)("p",null,"Returns true if ServiceWorker is supported by the browser."),(0,r.yg)("h4",{id:"enginegetproxiedurloriginalurl"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"engine.getProxiedUrl(originalURL)"))),(0,r.yg)("p",null,"Get the promise of proxied playback url."),(0,r.yg)("h4",{id:"engineenablep2p"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"engine.enableP2P()"))),(0,r.yg)("p",null,"Start p2p."),(0,r.yg)("h4",{id:"enginedisablep2p"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"engine.disableP2P()"))),(0,r.yg)("p",null,"Stop p2p, free used resources."),(0,r.yg)("h4",{id:"enginerestartp2p"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"engine.restartP2p()"))),(0,r.yg)("p",null,"Restart p2p \u3002"),(0,r.yg)("h2",{id:"p2penginemedia-events"},"P2PEngineMedia Events"),(0,r.yg)("h4",{id:"engineonpeerid-function-peerid-"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"engine.on('peerId', function (peerId) {})"))),(0,r.yg)("p",null,"Emitted when the peer Id of this client is obtained from server."),(0,r.yg)("h4",{id:"engineonpeers-function-peers-"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"engine.on('peers', function (peers) {})"))),(0,r.yg)("p",null,"Emitted when successfully connected with new peer."),(0,r.yg)("h4",{id:"engineonstats-function-stats-"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"engine.on('stats', function (stats) {})"))),(0,r.yg)("p",null,"Emitted when data is downloaded/uploaded.",(0,r.yg)("br",null),"\nstats.totalHTTPDownloaded: total data downloaded by HTTP(KB).",(0,r.yg)("br",null),"\nstats.totalP2PDownloaded: total data downloaded by P2P(KB).",(0,r.yg)("br",null),"\nstats.totalP2PUploaded: total data uploaded by P2P(KB).",(0,r.yg)("br",null),"\nstats.p2pDownloadSpeed: p2p download speed(KB/s)."),(0,r.yg)("h3",{id:"engineonserverconnected-function-connected-"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"engine.on('serverConnected', function (connected) {})"))),(0,r.yg)("p",null,"Emitted when websocket is opened/closed."),(0,r.yg)("h3",{id:"engineonexception-function-e-"},(0,r.yg)("strong",{parentName:"h3"},(0,r.yg)("em",{parentName:"strong"},"engine.on('exception', function (e) {})"))),(0,r.yg)("p",null,"Emitted when exception occured.",(0,r.yg)("br",null),"\ne.code: Exception identifier\uff08TRACKER_EXPT SIGNAL_EXPT\uff09",(0,r.yg)("br",null),"\ne.message: Exception message ",(0,r.yg)("br",null),"\ne.stack: Exception stack ",(0,r.yg)("br",null)),(0,r.yg)("h3",{id:"get-p2p-information-from-p2pconfig"},"Get p2p information from p2pConfig"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},"p2pConfig: {\n    getStats: function (totalP2PDownloaded, totalP2PUploaded, totalHTTPDownloaded, p2pDownloadSpeed) {\n        // get the downloading statistics\n    },\n    getPeerId: function (peerId) {\n        // get peer Id\n    },\n    getPeersInfo: function (peers) {\n        // get peers information\n    },\n    onHttpDownloaded: function (traffic) {\n        // listen to http downloaded traffic\n    },\n    onP2pDownloaded: function (traffic, speed) {\n        // listen to p2p downloaded traffic\n    },\n    onP2pUploaded: function (traffic) {\n        // listen to p2p uploaded traffic\n    },\n}\n")),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"The unit of download and upload is KB.\nThe unit of download speed is KB/s.")),(0,r.yg)("h4",{id:"mediaproxyversion-static"},(0,r.yg)("strong",{parentName:"h4"},(0,r.yg)("em",{parentName:"strong"},"MediaProxy.version"))," (static)"),(0,r.yg)("p",null,"Get the version of MediaProxy."),(0,r.yg)("h2",{id:"advanced-usage"},"Advanced Usage"),(0,r.yg)("h3",{id:"dynamic-mp4mp3-path-support"},"Dynamic MP4/MP3 Path Support"),(0,r.yg)("p",null,"The channelId is an identifier used by our backend to match peers that are watching the same content. It is an optional parameter, and by default, we generate channelId from the content URL by removing any query parameters and protocol from it.\nSome mp4/mp3 urls play the same live/vod but have different paths on them. For example, example.com/clientId1/streamId.mp4 and example.com/clientId2/streamId.mp4. In this case, you can format a common channelId for them."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-javascript"},"// Set token in p2pConfig before setting channelId! Connectivity with other platform should have the same token.\np2pConfig: {\n    token: YOUR_TOKEN,\n    channelId: function (url) {\n        const videoId = extractVideoIdFromUrl(url);   // make a channelId by removing the different part which is defined by yourself\n        return videoId;\n    }\n    // channelId: VIDEO_ID       // for fixed channel id\n}\n")),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"Interconnect with other platform should ensure that both have the same token and channelId.")))}y.isMDXComponent=!0},5680:(e,n,t)=>{t.d(n,{xA:()=>d,yg:()=>y});var r=t(6540);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach(function(n){a(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function p(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var g=r.createContext({}),l=function(e){var n=r.useContext(g),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},d=function(e){var n=l(e.components);return r.createElement(g.Provider,{value:n},e.children)},s="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef(function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,g=e.parentName,d=p(e,["components","mdxType","originalType","parentName"]),s=l(t),m=a,y=s["".concat(g,".").concat(m)]||s[m]||c[m]||i;return t?r.createElement(y,o(o({ref:n},d),{},{components:t})):r.createElement(y,o({ref:n},d))});function y(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,o=new Array(i);o[0]=m;var p={};for(var g in n)hasOwnProperty.call(n,g)&&(p[g]=n[g]);p.originalType=e,p[s]="string"==typeof e?e:a,o[1]=p;for(var l=2;l<i;l++)o[l]=t[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"}}]);