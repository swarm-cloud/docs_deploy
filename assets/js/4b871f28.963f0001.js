"use strict";(self.webpackChunkswarmcloud_docs=self.webpackChunkswarmcloud_docs||[]).push([[9597],{3779:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>g,contentTitle:()=>o,default:()=>f,frontMatter:()=>l,metadata:()=>p,toc:()=>c});r(6540);var t=r(5680);function a(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function i(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,t)}return r}(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}),e}function s(e,n){if(null==e)return{};var r,t,a=function(e,n){if(null==e)return{};var r,t,a={},i=Object.keys(e);for(t=0;t<i.length;t++)r=i[t],n.indexOf(r)>=0||(a[r]=e[r]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)r=i[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}const l={title:"Usage",slug:"/",sidebar_position:2},o=void 0,p={unversionedId:"usage",id:"usage",title:"Usage",description:"Prerequisites",source:"@site/docs/web-hls/usage.mdx",sourceDirName:".",slug:"/",permalink:"/home/web-hls/",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Usage",slug:"/",sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Introduction",permalink:"/home/web-hls/introduction"},next:{title:"Player Integration",permalink:"/home/web-hls/players"}},g={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Register Domain",id:"register-domain",level:4},{value:"Host Service Worker (Optional)",id:"host-service-worker-optional",level:2},{value:"Install P2P Engine",id:"install-p2p-engine",level:2},{value:"Script",id:"script",level:4},{value:"File",id:"file",level:4},{value:"Browserify / Webpack",id:"browserify--webpack",level:4},{value:"Usage",id:"usage",level:2},{value:"How it works",id:"how-it-works",level:2},{value:"Player Integration",id:"player-integration",level:2},{value:"File Explanation",id:"file-explanation",level:2},{value:"Electron",id:"electron",level:2}],u=e=>function(n){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,t.yg)("div",n)},y=u("Tabs"),d=u("TabItem"),m={toc:c},h="wrapper";function f(e){var{components:n}=e,r=s(e,["components"]);return(0,t.yg)(h,i(function(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},t=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),t.forEach(function(n){a(e,n,r[n])})}return e}({},m,r),{components:n,mdxType:"MDXLayout"}),(0,t.yg)("h2",{id:"prerequisites"},"Prerequisites"),(0,t.yg)("h4",{id:"register-domain"},"Register Domain"),(0,t.yg)("p",null,(0,t.yg)("a",{parentName:"p",href:"/guides/getting-started#for-web-app-integration"},"Register")," your domain to activate P2P service."),(0,t.yg)("admonition",{type:"tip"},(0,t.yg)("p",{parentName:"admonition"},"Localhost is always whitelisted. This means that you do not have to configure anything to perform tests locally.")),(0,t.yg)("h2",{id:"host-service-worker-optional"},"Host Service Worker (Optional)"),(0,t.yg)("details",null,(0,t.yg)("summary",null,"Click me"),"Secure your site with HTTPS, if it isn't already. HTTPS is required for Service Worker, which we'll set up in the next step. To maintain a high-security standard, foreign software to be integrated into the browser with the help of ServiceWorkers is not allowed. This is only possible if the software is hosted on the same server as the web page. So the ServiceWorkers only work if they are hosted under the same domain as the main page, meaning that a client running a website needs to host our web SDK on his own servers instead of getting it from our public cloud.",(0,t.yg)(y,{mdxType:"Tabs"},(0,t.yg)(d,{value:"a",label:"If you don't have a Service Worker",mdxType:"TabItem"},(0,t.yg)("p",null,"  Copy ",(0,t.yg)("a",{parentName:"p",href:"https://github.com/swarm-cloud/hls-p2p-engine/blob/main/demo/sw.js"},"sw.js")," to your server and make it available at ",(0,t.yg)("strong",{parentName:"p"},(0,t.yg)("em",{parentName:"strong"},"https://your_website.com/sw.js"))," .\nAlternatively, download ",(0,t.yg)("a",{parentName:"p",href:"https://cdn.jsdelivr.net/npm/@swarmcloud/hls/hls-proxy.js"},"hls-proxy.js")," then rename to sw.js .")),(0,t.yg)(d,{value:"b",label:"If you already have a Service Worker",mdxType:"TabItem"},(0,t.yg)("p",null,"  Integrate hls-proxy.js into your existing Service Worker by adding this code to the beginning of your Service Worker's root JavaScript file:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-javascript"},"self.importScripts('https://cdn.jsdelivr.net/npm/@swarmcloud/hls/hls-proxy.js')\n")),(0,t.yg)("p",null,"  Then set the correct path to sw.js for p2pConfig:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-javascript"},"var p2pConfig = {\n     swFile: PATH_TO_SW_FILE\n}\n")),(0,t.yg)("p",null,"  Once added, 1) your existing Service Worker will continue to be installed, and 2) SwarmCloud's imported Service Worker script will handle CDN 'fetch' events to intercept HLS request. All 'fetch' events not handled by SwarmCloud's Service Worker will fall through to your existing Service Worker's 'fetch' event handler(s).")))),(0,t.yg)("admonition",{type:"tip"},(0,t.yg)("p",{parentName:"admonition"},"You don't need to secure your site with HTTPS or host Service Worker if only hls.js is used.")),(0,t.yg)("h2",{id:"install-p2p-engine"},"Install P2P Engine"),(0,t.yg)("h4",{id:"script"},"Script"),(0,t.yg)("p",null,"Include the pre-built script of latest version bundled with hls.js, Or include the latest version without hls.js:"),(0,t.yg)(y,{groupId:"web-hls",mdxType:"Tabs"},(0,t.yg)(d,{value:"engine",label:"P2pEngine standalone",mdxType:"TabItem"},(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-html"},'<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"><\/script>\n<script src="https://cdn.jsdelivr.net/npm/@swarmcloud/hls/p2p-engine.min.js"><\/script>\n'))),(0,t.yg)(d,{value:"hlsjs",label:"P2pEngine built in",mdxType:"TabItem"},(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-html"},'<script src="https://cdn.jsdelivr.net/npm/@swarmcloud/hls/hls.min.js"><\/script>\n')))),(0,t.yg)("h4",{id:"file"},"File"),(0,t.yg)("p",null,(0,t.yg)("a",{parentName:"p",href:"https://github.com/swarm-cloud/hls-p2p-engine/releases"},"Click me"),(0,t.yg)("br",null),"This needs to be included before your player code. You can either prepend it to your compiled code or include it in a ",(0,t.yg)("inlineCode",{parentName:"p"},"<script>")," before it."),(0,t.yg)("h4",{id:"browserify--webpack"},"Browserify / Webpack"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-shell"},"npm install --save @swarmcloud/hls\n")),(0,t.yg)("p",null,"To include @swarmcloud/hls you need to require it in the player module:"),(0,t.yg)(y,{groupId:"web-hls",mdxType:"Tabs"},(0,t.yg)(d,{value:"engine",label:"P2pEngine standalone",mdxType:"TabItem"},(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-javascript"},"var Hls = require('hls.js');\nvar P2pEngineHls = require('@swarmcloud/hls').default;\n"))),(0,t.yg)(d,{value:"hlsjs",label:"P2pEngine built in",mdxType:"TabItem"},(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-javascript"},"var Hls = require('@swarmcloud/hls/hls.min');\n")))),(0,t.yg)("p",null,"If you are using ES6's import syntax:"),(0,t.yg)(y,{groupId:"web-hls",mdxType:"Tabs"},(0,t.yg)(d,{value:"engine",label:"P2pEngine standalone",mdxType:"TabItem"},(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-javascript"},"import Hls from 'hls.js';\nimport P2pEngineHls from '@swarmcloud/hls';\n"))),(0,t.yg)(d,{value:"hlsjs",label:"P2pEngine built in",mdxType:"TabItem"},(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-javascript"},"import Hls from '@swarmcloud/hls/hls.min';\n")))),(0,t.yg)("h2",{id:"usage"},"Usage"),(0,t.yg)(y,{groupId:"web-hls",mdxType:"Tabs"},(0,t.yg)(d,{value:"engine",label:"P2pEngine standalone",mdxType:"TabItem"},(0,t.yg)("p",null,"Create hls.js instance passsing ",(0,t.yg)("strong",{parentName:"p"},(0,t.yg)("em",{parentName:"strong"},"hlsjsConfig"))," as parameter. Create ",(0,t.yg)("strong",{parentName:"p"},(0,t.yg)("em",{parentName:"strong"},"P2pEngineHls"))," instance passing ",(0,t.yg)("strong",{parentName:"p"},(0,t.yg)("em",{parentName:"strong"},"p2pConfig"))," as parameter."),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-javascript"},"var p2pConfig = {\n    // Other p2pConfig options if applicable\n}\nvar engine;\nif (P2pEngineHls.isMSESupported()) {\n    var hls = new Hls();\n    p2pConfig.hlsjsInstance = hls;        // set hlsjs instance to SDK\n    engine = new P2pEngineHls(p2pConfig);\n    // Use hls just like your usual hls.js\u2026\n    hls.loadSource(contentUrl);\n    hls.attachMedia(video);\n    hls.on(Hls.Events.MANIFEST_PARSED,function() {\n        video.play();\n    });\n} else {\n    engine = new P2pEngineHls(p2pConfig);   // equal to new P2pEngineHls.ServiceWorkerEngine(p2pConfig);\n    engine.registerServiceWorker().catch(() => {}).finally(() => {\n        // native video playback here\n\n    });\n}\n"))),(0,t.yg)(d,{value:"hlsjs",label:"P2pEngine built in",mdxType:"TabItem"},(0,t.yg)("p",null,"Add ",(0,t.yg)("strong",{parentName:"p"},(0,t.yg)("em",{parentName:"strong"},"p2pConfig"))," as a property of hlsjsConfig, then Create hls.js instance passing ",(0,t.yg)("strong",{parentName:"p"},(0,t.yg)("em",{parentName:"strong"},"hlsjsConfig"))," as constructor param."),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-javascript"},"var p2pConfig = {\n    logLevel: 'debug',\n    // Other p2pConfig options if applicable\n}\nif(Hls.isSupported()) {\n    var hlsjsConfig = {\n        debug: true,\n        // Other hlsjsConfig options provided by hls.js\n        p2pConfig\n    };\n    // Hls constructor is overriden by included bundle\n    var hls = new Hls(hlsjsConfig);\n    // Use hls just like the usual hls.js ...\n    hls.loadSource(contentUrl);\n    hls.attachMedia(video);\n} else {\n    // use ServiceWorker based p2p engine if hls.js is not supported\n    var engine = new Hls.P2pEngine(p2pConfig);   // equal to  new Hls.P2pEngine.ServiceWorkerEngine(p2pConfig);\n    engine.registerServiceWorker().catch(() => {}).finally(() => {\n        // native video playback here\n\n    });\n}\n")))),(0,t.yg)("h2",{id:"how-it-works"},"How it works"),(0,t.yg)("p",null,"When the SDK is instantiated, it will give priority to trying to use hls.js based engine (hereinafter referred to as MSE Engine). If failed, try the ServiceWorker based engine (hereinafter referred to as SW Engine), as follows:"),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},"If the browser does not support webrtc datachannel, no engine will be enabled"),(0,t.yg)("li",{parentName:"ul"},"If the browser supports MSE && hlsjsInstance is passed in && proxyOnly is not set, try to enable the MSE Engine"),(0,t.yg)("li",{parentName:"ul"},"Otherwise, enable the SW Engine if ServiceWorker is supported")),(0,t.yg)("h2",{id:"player-integration"},"Player Integration"),(0,t.yg)("p",null,"See ",(0,t.yg)("a",{parentName:"p",href:"/web-hls/players"},"players demo")," ."),(0,t.yg)("h2",{id:"file-explanation"},"File Explanation"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre"},"@swarmcloud/hls/\n\u251c\u2500\u2500 hls.min.d.ts              # Typescript type information about hls.min.js and hls.light.min.js\n\u251c\u2500\u2500 hls.min.js                # Hls.js with P2pEngine built in\n\u2514\u2500\u2500 hls.light.min.js          # Hls.light.js with P2pEngine built in\n\u2514\u2500\u2500 p2p-engine.min.d.js       # Typescript type information about p2p-engine.min.js\n\u2514\u2500\u2500 p2p-engine.min.js         # P2pEngine that supports both Hls.js and ServiceWorker\n\u2514\u2500\u2500 p2p-engine.es.min.js      # P2pEngine that supports both Hls.js and ServiceWorker for ES Module\n\u2514\u2500\u2500 hlsjs-p2p-engine.min.js   # P2pEngine that supports Hls.js only\n\u2514\u2500\u2500 sw-p2p-engine.min.js      # P2pEngine that supports ServiceWorker only\n\u2514\u2500\u2500 hls-proxy.js              # The file that be imported by sw.js\n")),(0,t.yg)("h2",{id:"electron"},"Electron"),(0,t.yg)("p",null,(0,t.yg)("a",{parentName:"p",href:"https://electronjs.org/"},"Electron")," is also supported, you just need to register AppId and get a token from dashboard:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-javascript"},"var hlsjsConfig = {\n    p2pConfig: {\n        token: YOUR_TOKEN,\n        appName: YOUR_APP_NAME,\n        appId: YOUR_APP_ID,\n        // Other p2pConfig options if applicable\n    }\n};\n")),(0,t.yg)("p",null,"Learn more ",(0,t.yg)("a",{parentName:"p",href:"/guides/getting-started#for-mobile-app-integration"},"here")))}f.isMDXComponent=!0},5680:(e,n,r)=>{r.d(n,{xA:()=>g,yg:()=>d});var t=r(6540);function a(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function i(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,t)}return r}function s(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?i(Object(r),!0).forEach(function(n){a(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function l(e,n){if(null==e)return{};var r,t,a=function(e,n){if(null==e)return{};var r,t,a={},i=Object.keys(e);for(t=0;t<i.length;t++)r=i[t],n.indexOf(r)>=0||(a[r]=e[r]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)r=i[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var o=t.createContext({}),p=function(e){var n=t.useContext(o),r=n;return e&&(r="function"==typeof e?e(n):s(s({},n),e)),r},g=function(e){var n=p(e.components);return t.createElement(o.Provider,{value:n},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},y=t.forwardRef(function(e,n){var r=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,g=l(e,["components","mdxType","originalType","parentName"]),c=p(r),y=a,d=c["".concat(o,".").concat(y)]||c[y]||u[y]||i;return r?t.createElement(d,s(s({ref:n},g),{},{components:r})):t.createElement(d,s({ref:n},g))});function d(e,n){var r=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=r.length,s=new Array(i);s[0]=y;var l={};for(var o in n)hasOwnProperty.call(n,o)&&(l[o]=n[o]);l.originalType=e,l[c]="string"==typeof e?e:a,s[1]=l;for(var p=2;p<i;p++)s[p]=r[p];return t.createElement.apply(null,s)}return t.createElement.apply(null,r)}y.displayName="MDXCreateElement"}}]);