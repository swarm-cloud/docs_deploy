"use strict";(self.webpackChunkswarmcloud_docs=self.webpackChunkswarmcloud_docs||[]).push([[5909],{227:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>p,toc:()=>d});n(6540);var r=n(5680);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}const l={title:"P2P Optimization",sidebar_position:5},s=void 0,p={unversionedId:"optimization",id:"optimization",title:"P2P Optimization",description:"Introduction",source:"@site/docs/guides/optimization.mdx",sourceDirName:".",slug:"/optimization",permalink:"/home/guides/optimization",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"P2P Optimization",sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Signaling Service",permalink:"/home/guides/signaling"},next:{title:"Server as Peer",permalink:"/home/guides/super-peer"}},c={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Recommended m3u8 Config for live",id:"recommended-m3u8-config-for-live",level:2},{value:"Allow Http Range Request",id:"allow-http-range-request",level:2},{value:"RANGE REQUESTS",id:"range-requests",level:4},{value:"Example for NGINX",id:"example-for-nginx",level:4},{value:"Example for NIMBLE",id:"example-for-nimble",level:4},{value:"Web SDK Optimization Tip",id:"web-sdk-optimization-tip",level:2},{value:"Android SDK Optimization Tip",id:"android-sdk-optimization-tip",level:2},{value:"Deploy Super Peer",id:"deploy-super-peer",level:2}],u={toc:d},g="wrapper";function m(e){var{components:t}=e,n=i(e,["components"]);return(0,r.yg)(g,a(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}({},u,n),{components:t,mdxType:"MDXLayout"}),(0,r.yg)("h2",{id:"introduction"},"Introduction"),(0,r.yg)("p",null,"The performance results depend on a number of factors including time to live edge, bitrates offered, encoding profiles, ISPs served, audience geographical distribution, end-user device capacities, etc."),(0,r.yg)("br",null),"The configuration of m3u8(or mpd) will have a great impact on the P2P streaming. The proper configuration can significantly increase the P2P ratio. It is not recommended to use multi-bitrate m3u8/mpd.",(0,r.yg)("h2",{id:"recommended-m3u8-config-for-live"},"Recommended m3u8 Config for live"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"segment duration: 3 seconds to 4 seconds"),(0,r.yg)("li",{parentName:"ul"},"number of segment in playlist: >= 10")),(0,r.yg)("p",null,"Example for NGINX:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"rtmp {\n    server {\n        ...\n\n        application show {\n            ...\n\n            hls_fragment 4;                # 4 seconds fragments\n            hls_playlist_length 60;        # 60 seconds playlist\n\n        }\n    }\n}\n")),(0,r.yg)("h2",{id:"allow-http-range-request"},"Allow Http Range Request"),(0,r.yg)("p",null,"Range requests are used to get only a part of a file from the server (for instance, if part of the segment has been downloaded from peer, we retrieve the other part from the CDN). By using range requests you maximize the potential of our P2P technology. Without range requests, it is not possible to take advantage of chunks of media coming from P2P and if the segment is not downloaded as a whole, this data would be considered useless. If range request is activated, we are able to get chunks of data from peer and then complete the segments by getting other chunks from the CDN, thus, reducing your CDN bandwidth. Below is an example that shows how much CDN bandwidth is saved when range requests were activated:"),(0,r.yg)("br",null),(0,r.yg)("img",{width:"600",src:"https://cdn.swarmcloud.net/img/http-range.png",alt:"http-range"}),(0,r.yg)("br",null),"To activate range requests, you should enable OPTIONS requests, and range requests on both origin of your stream and CDN: #### OPTIONS REQUESTS (Required for Web) OPTIONS requests are mandatory to be able to perform RANGE requests in a cross-domain environment.",(0,r.yg)("p",null,"Your server/CDN must be able to handle OPTIONS requests. Most web-servers handle it natively."),(0,r.yg)("p",null,"The general idea is to add the following header to the HTTP response: \uff08only needed for web SDK\uff09"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"Access-Control-Allow-Methods: GET, OPTIONS\n")),(0,r.yg)("h4",{id:"range-requests"},"RANGE REQUESTS"),(0,r.yg)("p",null,"The general idea is to add the following header to the HTTP response:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"Access-Control-Allow-Headers: Range\nAccess-Control-Expose-Headers: Content-Length, Content-Range\n")),(0,r.yg)("h4",{id:"example-for-nginx"},"Example for NGINX"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';\nadd_header 'Access-Control-Allow-Headers' 'Range';\nadd_header 'Access-Control-Allow-Origin' '*';\nadd_header Accept-Ranges bytes;\n# allow CORS preflight requests\nif ($request_method = 'OPTIONS') {\n    add_header 'Access-Control-Allow-Headers' 'Range';\n    add_header 'Access-Control-Max-Age' 1728000;\n    add_header 'Content-Type' 'text/plain charset=UTF-8';\n    add_header 'Content-Length' 0;\n    return 204;\n}\n")),(0,r.yg)("h4",{id:"example-for-nimble"},"Example for NIMBLE"),(0,r.yg)("p",null,"Open your config file (Usually located at /etc/nimble/nimble.conf), add the following lines at the bottom of the file:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"access_control_allow_origin = *\naccess_control_expose_headers = Content-Length\naccess_control_allow_headers = Range\n")),(0,r.yg)("p",null,"Save the file and restart the nimble service using this command: sudo service nimble restart"),(0,r.yg)("h2",{id:"web-sdk-optimization-tip"},"Web SDK Optimization Tip"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/web-hls/API#specify-the-preferred-point-in-the-video-to-start-playback"},"Insert Time Offset Tag"))),(0,r.yg)("h2",{id:"android-sdk-optimization-tip"},"Android SDK Optimization Tip"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/android/API#callback-player-stats"},"Set Player Interactor")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"/android/API#specify-the-preferred-point-in-the-video-to-start-playback"},"Insert Time Offset Tag"))),(0,r.yg)("h2",{id:"deploy-super-peer"},"Deploy Super Peer"),(0,r.yg)("p",null,"See ",(0,r.yg)("a",{parentName:"p",href:"/guides/super-peer"},"here")," for details"))}m.isMDXComponent=!0},5680:(e,t,n)=>{n.d(t,{xA:()=>c,yg:()=>m});var r=n(6540);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),p=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},g=r.forwardRef(function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),g=o,m=d["".concat(s,".").concat(g)]||d[g]||u[g]||a;return n?r.createElement(m,i(i({ref:t},c),{},{components:n})):r.createElement(m,i({ref:t},c))});function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=g;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:o,i[1]=l;for(var p=2;p<a;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}g.displayName="MDXCreateElement"}}]);